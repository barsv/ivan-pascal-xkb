<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app210.us.archive.org';v.server_ms=218;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="/_static/js/bundle-playback.js?v=KTqwAcYd" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=UHAOicsW" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://pascal.tsu.ru:80/other/xkb/internals.html","20190509083229","https://web.archive.org/","web","/_static/",
	      "1557390749");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=fantwOh2" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->

<meta http-equiv="Content-Type" content="text/html; charset=windows-1251"/>
<title>Ivan Pascal (Homepage)</title>
<style type="text/css" media="all">@import url(/web/20190509083229cs_/http://pascal.tsu.ru/css/style.css);</style>
</head>
<body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20190509083229/http%3A//pascal.tsu.ru/other/xkb/internals.html"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://pascal.tsu.ru/other/xkb/internals.html" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20190509083229" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
		<div class="s" id="wm-nav-captures" style="flex:1;">
	  	  <a class="t" href="/web/20190509083229*/http://pascal.tsu.ru/other/xkb/internals.html" title="See a list of every capture for this URL">26 captures</a>
	  <div class="r" title="Timespan for captures of this URL">31 Dec 2003 - 09 Jul 2019</div>
	  </div>
	<div class="k">
	  <a href="" id="wm-graph-anchor">
	    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
	      <canvas id="wm-sparkline-canvas" width="675" height="27" border="0"></canvas>
	    </div>
	  </a>
	</div>
      </div>
    </div>
    <div class="n">
      <table>
	<tbody>
	  <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
	  <tr class="m">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190308231552/http://pascal.tsu.ru:80/other/xkb/internals.html" title="08 Mar 2019"><strong>Mar</strong></a></td>
	    <td class="c" id="displayMonthEl" title="You are here: 08:32:29 May 09, 2019">MAY</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20190709222430/http://pascal.tsu.ru:80/other/xkb/internals.html" title="09 Jul 2019"><strong>Jul</strong></a></td>
	  </tr>
	  <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
	  <tr class="d">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190308231552/http://pascal.tsu.ru:80/other/xkb/internals.html" title="23:15:52 Mar 08, 2019"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
	    <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 08:32:29 May 09, 2019">09</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20190709222430/http://pascal.tsu.ru:80/other/xkb/internals.html" title="22:24:30 Jul 09, 2019"><img src="/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
	  </tr>
	  <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
	  <tr class="y">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20170708033626/http://pascal.tsu.ru:80/other/xkb/internals.html" title="08 Jul 2017"><strong>2017</strong></a></td>
	    <td class="c" id="displayYearEl" title="You are here: 08:32:29 May 09, 2019">2019</td>
	    <td class="f" nowrap="nowrap">2020</td>
	  </tr>
	</tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
        	<span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
	</span>
        	<a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20190509083229/http://web.archive.org/screenshot/http://pascal.tsu.ru/other/xkb/internals.html"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru:80/other/xkb/internals.html" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru:80/other/xkb/internals.html" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
	<a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20190509083229/http://pascal.tsu.ru:80/other/xkb/internals.html</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(675,27,25,2,"web","http://pascal.tsu.ru/other/xkb/internals.html","20190509083229",1996,"/_static/",["/_static/css/banner-styles.css?v=fantwOh2","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->

<div style="position:absolute; top:10; right:0; z-index:3"><img src="/web/20190509083229im_/http://pascal.tsu.ru/img/logo.jpg"/>
<div style=" font-size:11px;">
<a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/en/">ENGLISH</a> | 
<a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/">KOI</a> | 
<a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/win/">WIN</a> | 
<a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/alt/">ALT</a> | 
<a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/iso/">ISO</a></div>
</div>

<div id="head"><div style="font-size: 13px; line-height: 20px; margin-bottom:30px;"><a style="" class="golink pascal__other_xkb_internals.html" href="https://web.archive.org/web/20190509083229/https://maxmoore.ru/catalog/brands/uppercut/matt-pomade/"> Uppercut МАТОВАЯ ПОМАДА ДЛЯ УКЛАДКИ ВОЛОС MATT POMADE 100 г.</a> </div><h2>Иван Паскаль</h2>
<div class="anotation">
Этот сайт посвящен описанию Операционной Системы
<noindex><a href="https://web.archive.org/web/20190509083229/http://www.freebsd.org/">FreeBSD</a></noindex> (одна из разновидностей Unix). 
<br/>
Я его сделал для того, чтобы хоть немного восполнить недостаток
документации, особенно на русском языке.<a href="unix"> Полная "Table of Contents"</a>
</p>
</div>
</div>


<table width="100%">
<tr>
<td width="300" valign="top">

<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/add/adding.html">Добавление компонент из дистрибутива</a></div>
	<ul>
		<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/add/packages.html">Установка "пакетов" (packages)</a></li>
		<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/add/ports.html">Установка "портов" (ports)</a></li>
		<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/add/sysinst.html">С помощью программы sysinstall</a></li>
		<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/add/manualy.html">Установка "вручную"</a></li>
	</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users0.html">Работа администратора с user account</a></div>
<ul>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users1.html">Что такое &quot;учетная карточка&quot;?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users2.html">Что  хранится в учетной карточке?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users3.html">Для чего используется учетная карточка?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users4.html">Где хранятся учетные карточки?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users5.html">Добавление пользователя</a></li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users6.html">Редактирование данных учетной карточки?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users7.html">Удаление пользователя</a></li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users8.html">Права пользователя на учетную карточку</a></li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users9.html">Временная блокировка пользователя</a></li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/users10.html">Что еще почитать?</a> </li>
</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/groups.html">Группы (пользователей)</a></div>
<ul>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/groups1.html">Что такое группа?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/groups2.html">Где хранится информация о группах?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/groups3.html">Колличество групп, юзеров в группе, групп у юзера</a></li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/groups4.html">Как создать или удалить группу?</a> </li>
  <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/users/groups5.html">Редактирование принадлежности юзера к группе</a> </li>
</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files1.html">Права доступа к файлам</a></div>
<ul>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files2.html">Какие атрибуты файла определяют &quot;право доступа&quot;.</a></li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files3.html">Основные биты доступа (чтение/запись/выполнение)</a> </li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files4.html">Дополнительные биты доступа</a> </li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files5.html">&quot;Странные&quot; сочетания битов доступа.</a> </li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files6.html">Флаги.</a> </li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files7.html">С какими правами файл &quot;рождается&quot;</a> </li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files7a.html">Права после копирования или перемещения</a></li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files8.html">Как поменять права </a></li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/files/files9.html">Что делать если этого не хватает?</a> </li>
</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/syscons.html">Драйвер "системной консоли" - syscons</a></div>
<ul>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/main.html">Основные возможности syscons</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/screen.html">Дисплей</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/keyboard.html">Клавиатура</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/kbd-examples.html">Примеры изменения назначения клавиш.</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/vidcontrol.html">Программа vidcontrol</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/kbdcontrol.html">Программа kbdcontrol</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/russian.html">Русификация syscons</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/termcap.html">&quot;Взаимопонимание&quot; программ с терминалом </a></li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/XWin.html"> Какое отношение это имеет к X-Window?</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/ansi.html">Команды (esc-последовательности) syscons</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/app2.html">Управляющие (&quot;контроловые&quot;) символы</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/app3.html">&quot;Функциональные&quot; клавиши</a> </li>
  <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/syscons/app4.html">Несколько мелких полезных программок.</a> </li>
</ul>
</div>
<div id="block">
<div class="title">Разное</div>
<ul>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/unix/lint/rebuild.html">Перегенерация ядра системы (kernel)</a></li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/frames.html">Фреймы Ethernet.</a></li>
	<li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/">XKB - "клавиатурный модуль" X-Window.</a></li>
</ul>
</div>
<div id="block">
<div class="title">Мои программы</div>
<ul>
	<li><a href="other/xxkb/">Xxkb</a> (для модуля XKB)</li>
	<li><a href="other/xxkb/README">README</a> и <a href="other/xxkb/CHANGES">CHANGES</a>.</li>
</ul>
</div>
</td>

<td class="content" valign="top" align="left"><h2>Немного о &quot;внутренностях&quot; XKB.</h2>
  <ul>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#codes">Основные термины - коды и символы.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#two-part">Две части XKB и &quot;проблема совместимости&quot;.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#symbols">Таблица символов</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#actions">Таблица действий.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#state-group">Состояние XKB: номер группы.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#wrap">Метод выравнивания номера группы.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#mods">Модификаторы.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#state-mods">Состояние XKB: модификаторы.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#types">Вычисление &quot;уровня&quot; (shift level). Типы клавиш.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#key">Какая еще информация хранится для каждого скан-кода.</a>
        <ul>
          <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#key-wrap">Метод &quot;выравнивания&quot; номера группы.</a> </li>
          <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#key-behavior">&quot;Поведение&quot; клавиши.</a> </li>
          <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#key-explicit">Набор &quot;исключений&quot;.</a> </li>
          <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#key-mods">Реальный и виртуальный модификаторы.</a> </li>
        </ul>
    </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#controls">Состояние XKB: Набор управляющих флагов (XKB Controls).</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#indicators">Индикаторы.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#compat">Таблица &quot;совместимости&quot;.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#radio">Радио-группы. (Radio Groups)</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#overlay">Перекрытия (Overlay).</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#accessx">AccessX.Дополнительные услуги для людей с ограниченными                физическими возможностями.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#mouse">Эмуляция &quot;мыши&quot;.</a> </li>
    <li><a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#bell">Расширенные возможности &quot;пищалки&quot; (Bell).</a> </li>
  </ul>
  <h3><a name="codes" id="codes">Основные термины - коды и символы.</a></h3>
  <p> Основное назначение модуля XKB - преобразовывать скан-коды нажимаемых  клавиш в коды символов. </p>
  <p> Обычно в документации XKB скан-коды называются <strong>keycodes</strong>, а коды  символов - просто &quot;символы&quot; (<strong>symbols</strong>). </p>
  <p> Естественно, &quot;символы&quot; - это не обязательно коды &quot;печатных&quot; символов  (букв, цифр, знаков препинания и т. п.). Это могут быть также &quot;управляющие&quot;  коды (Esc, Enter, Backspace и т. п.) или коды, которые никак не отображаются,  но влияют на внутренне состояние самого XKB (переключение РУС/ЛАТ, Control,  Shift, Alt и т.п.) и, следовательно, на то, какой символ будет выбран при  нажатии обычных &quot;буквенных&quot; клавиш. </p>
  <h3><a name="two-part" id="two-part">Две части XKB и &quot;проблема совместимости&quot;.</a></h3>
  <p> Прежде всего следует сказать несколько слов о том, как происходит  преобразование скан-кодов в символы при работе X Window System без модуля XKB. </p>
  <p> Сам X-сервер переводом скан-кода в код символа не занимается.    При нажатии или отпускании кнопки клавиатурный модуль X-сервера  посылает сообщение о событии (<strong>event</strong>) прикладной программе. </p>
  <p> В этом сообщении указывается только скан-код нажатой кнопки  и &quot;состояние клавиатуры&quot; - набор битовых флагов, который отражает  состояние клавиш-модификаторов (<strong>Shift, Control, Alt, CapsLock</strong> и т. п.). </p>
  <p> Клиентская программа должна сама решить, какой символ соответствует  скан-коду при таком сочетании битов-модификаторов. </p>
  <p> Естественно, для этого программа может воспользоваться таблицей,  хранящейся в X-сервере, в которой для каждого скан-кода перечислены  возможные символы.  Обычно програма при старте запрашивает эту таблицу у  сервера. (Таблицу на сервере можно менять с помощью утилиты <strong>xmodmap</strong>). </p>
  <p> Разумеется, при создании программ никто не пишет каждый раз процедуру  для интерпретации скан-кодов. Для этих целей существуют специальные  подпрограммы в библиотеке Xlib. <br/>
    Конечно, Xlib используется не только для этого. Это библиотека  низкоуровневых процедур для работы с X-сервером.  Даже если  программа пользуется высокоуровневыми библиотеками-&quot;тулкитами&quot; (Xaw,  Motif, Qt, gtk и т. п.), библиотека Xlib служит &quot;базовой&quot; для этих  тулкитов. </p>
  <p> Итак, процедуры из Xlib, зная скан-код и состояние клавиатуры,  в соответствии с таблицей символов, полученной от сервера при старте,  выбирают подходящий символ. </p>
  <p> Модуль XKB точно так же сообщает программе только скан-код и свое &quot;состояние&quot;.  В отличие от &quot;старого&quot; модуля (обычно говорят - &quot;<strong>core protocol</strong>&quot;,  будем его называть для краткости  - &quot;core-модуль&quot;), XKB имеет более сложную  таблицу символов, другой набор модификаторов и некоторые дополнительные  параметры &quot;состояния клавиатуры&quot; (обо всех этих отличиях мы поговорим по ходу  рассмотрения &quot;внутренностей&quot; XKB). </p>
  <p> Для полноценной работы с XKB библиотека Xlib должна содержать  процедуры преобразования скан-кодов, &quot;знакомые с Xkb&quot;. <br/>
    Естественно, &quot;иксы&quot;, у которых X-сервер &quot;укомплектован&quot; модулем XKB,  имеют и соответствующую библиотеку Xlib. </p>
  <p> Таким образом, XKB фактически делится на две части - модуль, встроенный  в X-сервер, и набор подпрограмм, входящих в библиотеку Xlib. </p>
  <p> Однако же, никто не запрещает использовать программы, которые были собраны  со старой библиотекой Xlib, &quot;не подозревающей&quot; о существовании XKB:  при этом и возникает &quot;проблема совместимости&quot;.  Модуль XKB  должен уметь общаться как со &quot;своей&quot; Xlib, так и со старой, работающей в  соответствии с core protocol. <br/>
    Естественно, &quot;общение&quot; не ограничивается только передачей сообщений о  нажатии/отпускании клавиш. Процедуры Xlib могут обращаться к X-серверу  с различными запросами (например, взять таблицу символов) и командами  (например, поменять в этой таблице расположение символов). <br/>
    На все эти запросы и команды модуль XKB должен реагировать так, чтобы  даже &quot;старая&quot; Xlib могла работать правильно (насколько это возможно). </p>
  <h3><a name="symbols" id="symbols">Таблица символов</a></h3>
  <p> Что же собой представляет таблица символов, связывающая символы со  скан-кодами и состоянием модификаторов? Рассмотрим сначала &quot;традиционную&quot;  таблицу символов, которая используется в core protocol. </p>
  <p> Как и во многих других клавиатурных модулях, ее можно представить как  обычную двумерную таблицу, где каждая строка соответствует скан-коду,  а столбцы - модификаторам или комбинации модификаторов. </p>
  <p> Прежде всего надо заметить, что в &quot;сообщении о нажатии/отпускании клавиши&quot;  под биты-модификаторы отводится один байт (октет) и соответственно, существует  восемь битов-модификаторов. Первые три называются - <strong>Shift, Lock, Control</strong>,  остальные &quot;безымянные&quot; - <strong>Mod1, Mod2, Mod3, Mod4, Mod5</strong>. <br/>
    Замечу, что хотя названия первых трех модификаторов явно намекают на то,  каким клавишам они должны соответствовать, на самом деле они могут быть  &quot;привязаны&quot; (то есть, менять свое значение при нажатии/отпускании клавиши)  к любым другим кнопкам. </p>
  <p> В данном случае нам важно, что восемь модификаторов могут составить 256  различных комбинаций. Поэтому теоретически таблица символов может содержать  до 256 столбцов. В то же время, в core protocol'е строго определены только  первые четыре колонки, в смысле - каким комбинациям модификаторов они  соответствуют. Легко догадаться, что в этих комбинациях используются только  два модификатора - <strong>Shift</strong> и <strong>Mode_switch</strong>. <br/>
    (Вы можете заметить, что среди модификаторов нет бита с именем <strong>Mode_switch</strong>. Совершенно верно. Его роль выполняет один из &quot;безымянных&quot;,  модификаторов - <strong>Mod1-Mod5</strong>. А <strong>Mode_switch</strong> - это название  одного из служебных символов.  Когда приложение запрашивает у сервера  таблицу символов, оно также выясняет, какой из безымянных модификаторов  связан с этим символом, и в дальнейшем по состоянию этого модификатора  догадывается о том, нажал ли пользователь клавишу, соответствующую  символу <strong>Mode_switch</strong>.) </p>
  <p> Итак. Первые четыре колонки в таблице соответствуют &quot;состояниям&quot; - </p>
  <table border="2">
    <tbody>
      <tr>
        <th width="25%"> &quot;никаких модификаторов&quot; </th>
        <th width="25%"> Shift </th>
        <th width="25%"> Mode_switch </th>
        <th width="25%"> Mode_switch+Shift </th>
      </tr>
    </tbody>
  </table>
  </p>
  <p> <br/>
    В терминах core protocol можно сказать, что состояние <strong>Mode_switch</strong> выбирает одну из двух  групп (не надо путать их с XKB группами, о которых мы поговорим  позднее), а состояние <strong>Shift</strong> - одну из двух колонок внутри группы. <br/>
    Как вы скорее всего знаете, разные группы обычно используются для  разных языков (алфавитов), а <strong>Shift</strong> выбирает строчные или  прописные буквы  в пределах одного алфавита. </p>
  <table border="2">
    <tbody>
      <tr>
        <th rowspan="2">  </th>
        <th colspan="2"> Group 1 </th>
        <th colspan="2"> Group 2 </th>
      </tr>
      <tr>
        <th width="20%">   </th>
        <th width="20%"> Shift </th>
        <th width="20%"> Mode_switch </th>
        <th width="20%"> Mode_switch+Shift </th>
      </tr>
      <tr>
        <td colspan="5"> ... </td>
      </tr>
      <tr>
        <td>keycode 38</td>
        <td align="center"> a</td>
        <td align="center"> A</td>
        <td align="center"> Cyrillic_ef </td>
        <td align="center"> Cyrillic_EF </td>
      </tr>
      <tr>
        <td>keycode  39</td>
        <td align="center"> s</td>
        <td align="center"> S</td>
        <td align="center"> Cyrillic_yeru </td>
        <td align="center"> Cyrillic_YERU </td>
      </tr>
      <tr>
        <td>keycode  40</td>
        <td align="center"> d</td>
        <td align="center"> D</td>
        <td align="center"> Cyrillic_ve </td>
        <td align="center"> Cyrillic_VE </td>
      </tr>
      <tr>
        <td colspan="5"> ... </td>
      </tr>
    </tbody>
  </table>
  </p>
  <p> Заметьте также, что ни <strong>Lock</strong>, ни <strong>Control</strong> в выборе символа  из таблицы не участвуют. Если эти модификаторы активны, то отдельные  подпрограммки Xlib после выбора символа из таблицы делают соответствующие  преобразования этих символов. </p>
  <p> Вернемся к XKB. Как видите, недостаток &quot;традиционной&quot; таблицы - ее  &quot;негибкость&quot;. Хотя колонок может быть до 256, &quot;стандартно&quot; обрабатываются  только первые четыре, причем их зависимость от состояния модификаторов  жестко &quot;зашита&quot; в алгоритмах Xlib. </p>
  <p> Поэтому одно из основных усовершенствований, которые были внесены при  разработке XKB - большая гибкость в построении таблицы. </p>
  <ul>
    <li> Во-первых, в XKB колонки не связаны жестко с конкретными модификаторами.  В одном из файлов конфигурации XKB описывается зависимость номера колонки  от произвольного набора модификаторов. Естественно, эти зависимости можно  изменять и добавлять простым редактированием соответствующего файла.  (Подробнее о них смотри ниже: <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#types">Вычисление &quot;уровня&quot; (shift level).  Типы клавиш.</a>) </li>
    <li> Во-вторых, в одной и той же &quot;раскладке клавиатуры&quot; разные  клавиши могут соответствовать разному количеству символов в  зависимости от модификаторов.  Например,
      <ul>
          <li>клавиша <strong>Enter</strong> вообще не зависит от модификаторов, то есть  в соответствующей строке имеет смысл только одна колонка; </li>
        <li>клавиша с символами '1' и '!' содержит две колонки, выбор конкретной  зависит только от <strong>Shift</strong>, </li>
        <li>а клавиша с символами '-','_'и '=' может иметь три колонки, выбор  которых зависит от двух модификаторов - <strong>Shift</strong> и <strong>Mod1</strong> </li>
      </ul>
    </li>
    <li> При таком подходе понятие &quot;группа&quot; сильно меняет свой  смысл. Мы уже не можем определять группу как &quot;пачку&quot; колонок, поскольку  для разных клавиш размер этой &quot;пачки&quot; будет разным. <br/>
      Вообще-то, при той гибкости в связывании колонок с модификаторами,  которую дает XKB, можно было бы вообще забыть о группах или просто говорить,  что группа -это группа колонок, объединенных модификатором  (тем же <strong>Mode_switch</strong>).  Но... </li>
  </ul>
  <p> Делить таблицу на группы удобнее. Во-первых, так легче провести границу  между разными алфавитами (если, конечно, таковые используются в раскладке).  Заметьте, что в некоторых случаях хотелось бы иметь не два разных алфавита,  а больше. Причем раскладки для разных алфавитов могли бы составлять  разные люди, независимо друг от друга <br/>
    Во-вторых, чем больше модификаторов участвуют в выборе колонок,  тем сложнее и запутаннее становятся соответствующие описания зависимостей. </p>
  <p> Поэтому, авторы XKB использовали радикальный подход - в одной и той же  раскладке может быть несколько (до четырех) отдельных таблиц. Вот эти  таблицы и называются группами XKB (или просто <strong>groups</strong>). </p>
  <p> Вообще-то, правильнее сказать не &quot;несколько двумерных таблиц в одной  раскладке&quot;, а - у каждого скан-кода (<strong>keycode</strong>) может быть до четырех  &quot;однострочных&quot; таблиц - групп. <br/>
    Потому, что ... </p>
  <ul>
    <li> Назначение некоторых клавиш (той же <strong>Enter</strong>) не меняется в разных  алфавитах, поэтому для них не требуется деление таблицы на несколько отдельных  групп. </li>
    <li> Даже в пределах одной группы (алфавита) разные клавиши могут иметь  разное количество колонок. То есть, &quot;ширина&quot; таблицы меняется не только   &quot;от группы к группе&quot; но и &quot;от  скан-кода к скан-коду&quot;. Поэтому удобнее  описывать каждую отдельную группу для каждого отдельного скан-кода. </li>
    <li> И, наконец, с каждым скан-кодом связаны еще некоторые параметры  (см. <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#key">ниже </a>), которые не зависят от номера группы.  Поэтому, если бы мы описывали один и тот же скан-код в разных таблицах-группах,  эта информация могла бы оказаться противоречивой. </li>
  </ul>
  <p> Итак. </p>
  <ul>
    <li> Для каждого скан-кода (<strong>keycode</strong>) в XKB &quot;раскладке&quot; хранится  несколько однострочных таблиц символов, которые называются &quot;группами&quot;. </li>
    <li> Каждая такая таблица может делиться на несколько колонок - &quot;уровней&quot;  (<strong>shift level</strong>) </li>
    <li> Какая из таблиц-строчек актуальна в данный момент, определяется  текущим номером группы (или просто - <strong>group</strong>). Текущий номер группы  хранится в X-сервере и сообщается приложению в событии о нажатии/отпускании  клавиши вместе со скан-кодом и набором модификаторов. </li>
    <li> Выбор нужной колонки (<strong>shift level</strong>) определяется состоянием  модификаторов. </li>
    <li> Разные <strong>keycode</strong> могут иметь разное количество групп. </li>
    <li> В разных группах даже одного и того же <strong>keycode</strong> может быть  разное количество <strong>shift level</strong>. </li>
  </ul>
  <table border="2">
    <tbody>
      <tr>
        <th> keycode </th>
        <th> номер группы </th>
        <th> количество level'ов </th>
        <th colspan="4">  </th>
      </tr>
      <tr>
        <td align="center"> 36</td>
        <td align="center"> 1 </td>
        <td align="center"> одна колонка </td>
        <td align="center"><strong>Enter</strong></td>
        <td colspan="3">  </td>
      </tr>
      <tr>
        <td rowspan="3" align="center"> 38</td>
        <td align="center"> 1 </td>
        <td align="center"> две колонки </td>
        <td align="center"> a</td>
        <td align="center"> A</td>
        <td colspan="2">  </td>
      </tr>
      <tr>
        <td align="center"> 2 </td>
        <td align="center"> две колонки </td>
        <td align="center"> Cyrillic_ef </td>
        <td align="center"> Cyrillic_EF </td>
        <td colspan="2">  </td>
      </tr>
      <tr>
        <td align="center"> 3 </td>
        <td align="center"> две колонки </td>
        <td align="center"> Greek_alpha </td>
        <td align="center"> Greek_ALPHA </td>
        <td colspan="2">  </td>
      </tr>
      <tr>
        <td rowspan="2" align="center"> 21 </td>
        <td align="center"> 1 </td>
        <td align="center"> две колонки </td>
        <td align="center"> + </td>
        <td align="center"> = </td>
        <td colspan="2">  </td>
      </tr>
      <tr>
        <td align="center" width="12%"> 2 </td>
        <td align="center" width="12%"> четыре колонки </td>
        <td align="center" width="12%"> + </td>
        <td align="center" width="12%"> = </td>
        <td align="center" width="12%"> \ </td>
        <td align="center" width="12%"> ; </td>
      </tr>
      <tr>
        <td colspan="7"> ... </td>
      </tr>
    </tbody>
  </table>
  <p> Наконец, надо сказать, что групп может быть от одной до четырех, а  уровней - до 64. </p>
  <h3><a name="actions" id="actions">Таблица действий.</a></h3>
  <p> Кроме &quot;таблицы символов&quot; к скан-коду может быть &quot;привязана&quot; аналогичная  &quot;таблица действий&quot; (<strong>actions</strong>). Эта таблица также делится на  подтаблицы (группы) и колонки (уровни). </p>
  <p> В отличие от таблицы символов, которая используется приложением (X-сервер  ее только хранит, чтобы сообщить каждому вновь стартующему приложению),  таблица действий используется самим сервером. </p>
  <p> В ее ячейках располагаются вызовы внутренних процедур XKB, которые  меняют его состояние - текущую <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#state-group">группу</a>,   состояние <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#state-mods">модификаторов</a> и <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#controls">внутренних флагов XKB</a>. </p>
  <p> Точнее - действия, выполняемые <strong>actions</strong>, не ограничиваются измениями   состояния XKB. Они также используются для </p>
  <ul>
    <li> <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#mouse">эмуляции событий мыши</a> (перемещения указателя и нажатия mouse buttons) </li>
    <li> генерации специальных events для приложений </li>
    <li> переключения экранов </li>
    <li> выключения X-сервера </li>
    <li> и т.п. </li>
  </ul>
  <p> Немного подробнее о всех возможных <strong>actions</strong> написано в разделе <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/gram-actions.html">Описание действий</a>. </p>
  <p> Если на клавише для группы и позиции в группе определено действие, то  для этой же группы и позиции в группе для той же клавиши должен быть  определен символ (обычно служебный). </p>
  <p> Заметим, что в core-модуле понятия &quot;действие&quot; вообще нет. </p>
  <h3><a name="state-group" id="state-group">Состояние XKB: номер группы.</a></h3>
  <p> Текуший номер группы хранится в &quot;таблице состояния&quot; XKB. <br/>
    Точнее, внутри XKB имеются три ячейки </p>
  <ul>
    <li> <strong>locked group</strong> - некий аналог нажатия клавиши <strong>CapsLock</strong>, но для групп </li>
    <li> <strong>latched group</strong> - аналог действия клавиши <strong>Shift</strong>, но, опять же, для групп </li>
    <li> <strong>base group</strong> - базовое смещение номера группы </li>
  </ul>
  Обычно содержимое этих переменных меняется с помощью действий  (<strong>actions</strong>), которые связываются с подходящими клавишами (их скан-кодами).
  <p> Наконец, существует понятие &quot;фактической&quot; (<strong>effective</strong>) или &quot;действующей&quot;   группы. Именно ее значение используется для выбора подтаблицы-группы в таблице  символов и таблице действий.  Это значение не хранится, а каждый раз  вычисляется в виде суммы трех вышеуказанных переменных. </p>
  <h3><a name="wrap" id="wrap">Метод выравнивания номера группы.</a></h3>
  <p> Естественно, при таком суммировании может получиться число, большее  чем количество заданных групп. Чтобы получить из него какой-нибудь  допустимый номер группы, XKB может использовать три разных метода: </p>
  <ul>
    <li> <strong>Wrap</strong> (&quot;заворачивание&quot;) - получившееся число делится на количество групп  и берется остаток от деления. Этот метод используется по умолчанию. </li>
    <li> <strong>Clamp</strong> (&quot;удержание в границах&quot;) - если получилось число большее чем номер  последней группы, то берется этот самый &quot;номер последней группы&quot;, если же  получилось число меньше, чем номер самой первой группы, то берется первая  группа. </li>
    <li> <strong>Redirect</strong> (&quot;перенаправление&quot; или, точнее - &quot;замена&quot;) - если используется  этот метод, то в &quot;состоянии XKB&quot; должен быть определен еще один  дополнительный параметр - номер группы &quot;куда перенаправить&quot; (или - &quot;чем  заменить&quot;). Если получившееся число выходит за пределы допустимых значений  для групп, оно просто заменяется этой самой &quot;чем заменить&quot;. Кстати, если  и этот номер не уложится в допустимые границы, то XKB подставит первую  группу. </li>
  </ul>
  <h3><a name="mods" id="mods">Модификаторы.</a></h3>
  <p> Кроме переменных, содержащих номера групп, &quot;состояние XKB&quot; определяется  &quot;флажками&quot; - модификаторами. Эти битовые флаги меняются при нажатии  клавиш <strong>Shift, CapsLock, Alt, Control</strong> и т. п. и, естественно, влияют на  выбор подходящего символа из таблиц. </p>
  <p> Как я уже упоминал, &quot;core protocol&quot; (протокол &quot;общения&quot; между &quot;традиционным&quot;  клавиатурным модулем и Xlib)  тоже имеет &quot;набор модификаторов&quot; (который и сообщается прикладной программе  при нажатии кнопок). Эти модификаторы (8 бит) называются <strong>Shift, Lock, Control,  Mod1-Mod5</strong>. В зависимости от их состояния Xlib выбирает подходящий символ  и может выполнять дополнительные действия - делать из обычных символов  управляющие, менять прописные/строчные буквы и т. п. <br/>
    Кроме того, программа может сама (помимо Xlib) по-своему  интерпретировать эти модификаторы и менять свое поведение. </p>
  <p> Поэтому, хотя XKB имеет больше модификаторов и его поведение  (действия, выполняемые при определенной комбинации модификаторов) можно  гибко перестраивать (как при старте, так и в процессе работы), модуль XKB  вынужден эмулировать &quot;классический&quot; набор модификаторов, специально для  старых клиентских программ (и старой Xlib). </p>
  <p> Итак. Модификаторы core protocol'а в XKB называются &quot;реальными&quot; (<strong>real</strong>)  модификаторами и их названия такие же, как в core protocol. </p>
  <p> Кроме того, XKB имеет еще 16 своих внутренних модификаторов,  которые называются &quot;виртуальными&quot; (<strong>virtual</strong>) модификаторами. </p>
  <p> К сожалению, &quot;проблема совместимости&quot; заключается еще и в том, что в формате  &quot;сообщения о клавише&quot; для модификаторов отведено только восемь бит. Поэтому  XKB при всем желании не может сообщить приложению все свои шестнадцать  виртуальных модификаторов и вынужден в любом случае отображать их в &quot;реальные&quot;  (даже для приложений &quot;знакомых с XKB&quot;). Единственным утешением является то,  что можно сколько угодно виртуальных модификаторов отобразить в один  реальный и это отображение легко перенастраивается. </p>
  <p> Итак. Эти модификаторы выполняют несколько функций </p>
  <ul>
    <li> по их состоянию &quot;вычисляется&quot; <strong>shift level</strong> для выбора нужного  символа и/или &quot;действия&quot;; </li>
    <li> по их состоянию &quot;вычисляется&quot; состояние индикаторов (см. ниже); </li>
    <li> и, кроме того, они могут влиять на выполнение некоторых других действий  XKB (вычисление номера группы и т.п.). </li>
  </ul>
  <h3><a name="state-mods" id="state-mods">Состояние XKB: модификаторы.</a></h3>
  <p> Так же как и номер группы, набор битов-модификаторов внутри XKB  существует в трех экземплярах (в трех переменных) </p>
  <ul>
    <li> <strong>locked modifiers</strong> </li>
    <li> <strong>latched modifiers</strong> </li>
    <li> <strong>base modifiers</strong> </li>
  </ul>
  Содержимое этих переменных (так же как и &quot;групповых&quot;) может меняться  с помощью действий (<strong>actions</strong>).
  <p> Как и для номеров групп, для модификаторов существует &quot;фактический&quot;  набор модификаторов, который определяется как логическая сумма  (побитная операция <strong>ИЛИ</strong>) трех указанных переменных.  Соответственно, никаких дополнительных &quot;выравниваний&quot;, как для  значения номера группы, не требуется. </p>
  <h3><a name="types" id="types">Вычисление &quot;уровня&quot; (shift level). Типы клавиш.</a></h3>
  <p> В отличие от номера группы, уровень не запоминается в состоянии XKB,  а вычисляется из состояния модификаторов.  При этом для различных  клавиш зависимость уровня от модификаторов может различаться. </p>
  <p> Для того чтобы обеспечить такую гибкость, в XKB существут понятие  &quot;тип клавиши&quot;. </p>
  <p> В каждом описании типа клавиши задается некая функция - какие модификаторы  принимать к рассмотрению и какой уровень должен получится при определенном  сочетании модификаторов. <br/>
    Соответственно, у каждой клавиши (скан-кода) в каждой под-таблице  (группе) указывается свой &quot;идентификатор типа&quot;. </p>
  <p> Естественно, при нажатии клавиши XKB (точнее, процедуры Xlib) определяет,  к какому типу она относится и по описанию типа и текущему состоянию  модификаторов вычисляет, из какого уровня следует выбрать символ для  этого скан-кода. </p>
  <p> Надо отметить, что хотя описания типов и принадлежность каждой  клавиши к определенному типу можно гибко менять, в XKB по умолчанию  задан основной набор типов и для всех клавиш расписаны идентификаторы  типов.  Поэтому обычно нет необходимости задавать эти параметры  в файлах конфигурации XKB. </p>
  <h3><a name="key" id="key">Какая еще информация хранится для каждого скан-кода.</a></h3>
  <p> Кроме таблицы символов (и, возможно, &quot;действий&quot;) с каждым скан-кодом  связаны еще несколько переменных </p>
  <ul>
    <li> метод &quot;выравнивания&quot; номера группы, специфичный для данной клавиши; </li>
    <li> &quot;поведение&quot; клавиши; </li>
    <li> набор &quot;исключений&quot;; </li>
    <li> реальный модификатор (modmap) и виртуальный модификатор (vmodmap),  связанные с этой клавишей. </li>
  </ul>
  <h4><a name="key-wrap" id="key-wrap">Метод &quot;выравнивания&quot; номера группы.</a></h4>
  <p> Поскольку разные клавиши могут иметь разное количество групп, может  возникнуть ситуация, когда вычисленный и &quot;выровненный&quot; эффективный номер  группы все-таки не попадает в дапазон допустимых групп для данной клавиши. </p>
  <p> В этом случае эффективный номер группы может дополнительно &quot;выравниваться&quot;,  специально для данной клавиши. </p>
  <p> Возможные методы точно такие же, как и <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#wrap">&quot;глобальные&quot;</a>. По умолчанию  используется метод Wrap. </p>
  <h4><a name="key-behavior" id="key-behavior">&quot;Поведение&quot; клавиши.</a></h4>
  <p> Эта переменная состоит из двух частей - набора флагов и дополнительного  аргумента. Обычно аргумент не нужен. Но некоторые флаги подразумевают  дполнительный числовой аргумент, а смысл этого аргумента зависит от флага. </p>
  <p> Флаги определяют </p>
  <ul>
    <li> нужен ли &quot;автоповтор&quot; для этой клавиши (Строго говоря, флаг &quot;автоповтор&quot;  хранится в другом месте, а не в переменной &quot;поведение&quot;. Но в данном  случае это не так уж важно.) </li>
    <li> обычная эта клавиша или &quot;залипающая&quot; (то есть, по первому нажатию  клавша &quot;залипает&quot; и отпускается при повторном нажатии). При этом &quot;залипание&quot;  клавиши может отрабатываться самим &quot;железом&quot; или эмулироваться модулем XKB. </li>
    <li> принадлежность этой клавиши к какой-нибудь <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#radio">&quot;радио-группе&quot;</a>. При этом  дополнительный аргумент указывает номер такой &quot;радио-группы&quot;. </li>
    <li> принадлежит ли эта клавиша к <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#overlay">&quot;перекрывающейся группе&quot;</a> (<strong>overlay</strong>).  Таких групп может быть всего две. Какая группа в данный момент активна,  определяется <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#controls">&quot;управляющими флагами&quot;</a> <strong>overlay1</strong> и <strong>overlay2</strong>. Соответственно в &quot;поведении клавиши&quot; есть  два флага которые и определяют принадлежность клавши к той или другой группе,  а дополнительный аргумент указывает - какой скан-код должна эмулировать  клавиша, если включен &quot;режим перекрытия&quot;. </li>
  </ul>
  <h4><a name="key-explicit" id="key-explicit">Набор &quot;исключений&quot;.</a></h4>
  <p> Это битовая маска, которая указывает - какая информация, связанная  с клавишей, &quot;задана точно&quot; (<strong>explicit</strong>) и не должна изменяться в некоторых  случаях. Дело в том, что в core protocol определены команды, с помощью которых  программы могут менять &quot;раскладку клавиатуры&quot; внутри клавиатурного модуля  X-сервера. Естественно, эти комады меняют только &quot;привязку&quot; символов,  поскольку другие &quot;свойства&quot; скан-кодов в core protocol'е не определены. </p>
  <p> Для того, чтобы XKB мог при этом поменять и &quot;привязку&quot; других &quot;свойств&quot;,  в нем предусмотрен специальный механизм - &quot;интерпретации&quot; символов  (об этом см.ниже). </p>
  <p> Так вот. Набор &quot;исключений&quot; может защитить информацию, связанную с  конкретным скан-кодом, именно от таких косвенных изменений. <br/>
    Если прикладная программа будет пользоваться соответствующим запросами  XKB модуля (а не core protocol), такой защиты не требуется. </p>
  <p> Итак, с помощью этой маски можно запретить </p>
  <ul>
    <li> изменение типа клавиши (количество уровней) для каждой группы (можно  установить запрет для каждой группы поотдельности); </li>
    <li> изменения, которые могут произойти при применнии &quot;интерпретации&quot;,  при этом можно запретить -
      <ul>
          <li> вообще все изменения, вызываемые &quot;интерпретацией&quot;; </li>
        <li> изменение флагов &quot;автоповтор&quot; и &quot;залипание&quot;; </li>
        <li> изменение набора виртуальных модификаторов. </li>
      </ul>
    </li>
  </ul>
  <h4><a name="key-mods" id="key-mods">Реальный и виртуальный модификаторы.</a></h4>
  <p> Обратите внимание, что с каждым скан-кодом связаны две разные переменные  (<strong>modmap</strong> и <strong>vmodmap</strong>), одна для реальных модификаторов,  другая - для виртуальных. </p>
  <p> Набор реальных модификаторов служит для эмуляции &quot;традиционного&quot; набора  модификаторов (в соответствии с core protocol), а набор виртуальных  модификаторов может служить аргументами для &quot;действий&quot;, связанных с этой  клавишей. </p>
  <p> Надо заметить, что изменения набора виртуальных модификаторов (<strong>base,  locked</strong> и <strong>latched</strong>) делается с помощью соответствующих &quot;действий&quot;. Естественно,  одним из аргуметов этого &quot;действия&quot; должен быть модификатор (или несколько  модификаторов), которые нужно установить/сбросить в соответствующих  &quot;переменных состояния&quot;. Так вот, при описании &quot;действия&quot;, модификаторы можно  указать явно, а можно просто сослаться на <strong>vmodmap</strong> (то есть -  &quot;установить витруальные модификаторы, привязанные к этой клавише&quot;). </p>
  <p> А вот изменение модификатора в &quot;эмулируемом наборе модификаторов&quot;  происходит автоматически при нажатии/отпускании клавиши. Естественно,  устанавливаются/сбрасываются именно те модификаторы, которые указаны  в наборе реальных модификаторов (<strong>modma</strong>p). </p>
  <p> Кроме того, эти два набора служат для установления соответствия между  реальными и виртуальными модификаторами. Надо заметить, что виртуальный  модификатор не имеет никакого смысла, если не связан с каким-нибудь  реальным модификатором. </p>
  <h3><a name="controls" id="controls"> Состояние XKB: Набор управляющих флагов (XKB Controls).</a></h3>
  <p> Кроме номера группы и набора модификаторов, в XKB существует аналогичный  набор для &quot;управляющих флагов&quot;. Правда, в отличии от номера группы  и набора модификаторов, которые &quot;размазаны&quot; по трем переменным  (<strong>base, locked, latched</strong>), набор управляющих флагов только один. </p>
  <p> В &quot;управляющие флаги&quot; входят все те &quot;флажки&quot;, которые не попали в  &quot;набор модификаторов&quot;. Они не сообщаются приложению, а используются  XKB для переключения его внутренних режимов. <br/>
    Эти флаги управляют </p>
  <ul>
    <li> включением <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#overlay">режима перекрытия</a> для части клавиатуры; </li>
    <li> включением режима <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#mouse">эмуляции мыши</a>. </li>
    <li> включением различных режимов подсистемы <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#accessx">AccessX</a>. </li>
    <li> и некоторыми другими сойствами XKB. </li>
  </ul>
  <p> &quot;Управляющие флаги&quot; (как и номера групп и модификаторы) меняются  соответствущими <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#actions">действиями</a>, привязанными к подходящим клавишам. </p>
  <h3><a name="indicators" id="indicators">Индикаторы.</a></h3>
  <p> Как известно, на клавиатуре кроме &quot;кнопок&quot; имеется несколько &quot;лампочек&quot;-  индикаторов. Управление этими индикаторами тоже входит в обязанности XKB. <br/>
    В XKB может существовать до 32 индикаторов. <br/>
    Естественно, на клавиатуре отображаются только первые 3-4 из них.  Эти индикаторы называются в XKB &quot;физическими&quot;, а остальные - &quot;виртуальными&quot;.  Состояние виртуальных модификаторов может быть считано из XKB и отображаться  на экране специальными программами (<strong>xkbvleds</strong>, <strong>mxkbledpanel</strong>). </p>
  <p> Каждый индикатор может быть связан с компонентом &quot;состояниея XKB&quot;  (модификатором, номером группы, &quot;управляющим флагом&quot;) и, соответственно,  состояние индикатора будет автоматически отражать состояние своего  &quot;компонента состояния XKB&quot;. </p>
  <p> Причем, в XKB существуют специальные запросы, которыми прикладная программа  может управлять состянием какого-нибудь индикатора (&quot;зажигать&quot;/&quot;гасить&quot; его).  Заметьте, речь идет о том, что программа может просто включать/выключать  &quot;лампочку&quot;, а не менять состояние клавиатуры, которое &quot;отслеживается&quot;  этой &quot;лампочкой&quot;. </p>
  <p> Поэтому, с каждым индикатором связан набор флагов, который определяет </p>
  <ul>
    <li> можно ли прикладной программе управлять самим этим индикатором (или для его  включения/выключения обязательно надо изменить &quot;состояние клавиатуры&quot;; </li>
    <li> &quot;привязан&quot; ли этот индикатор к &quot;состоянию клавиатуры&quot; или он  включается/выключается только прикладными программами; </li>
    <li> и, наконец, будет ли такое включение/выключение иметь &quot;обратную связь&quot;.  То есть, можно настроить индикаторы так, что включение/выключение &quot;лампочки&quot;  прикладной программой будет вызывать автоматически соответствующие изменения  &quot;состояния клавиатуры&quot; (модификаторов, номера группы, управляющих флагов). </li>
  </ul>
  <h3><a name="compat" id="compat">Таблица &quot;совместимости&quot;.</a></h3>
  <p> Как уже упоминалось, XKB вынужден решать &quot;проблему совместимости&quot; с  программами, которые не подозревают о существовании XKB и обращаются  с запросами к &quot;core-модулю&quot; X-сервера. </p>
  <p> Естественно, модуль XKB может обработать эти запросы, но основная  проблема, возникающая при этом, состоит в том, что в модуле XKB вводятся  некоторые новые понятия (новые относительно core protocol'а), которые никак  не отражены в &quot;традиционных&quot; запросах к клавиатурному модулю. </p>
  <ul>
    <li> Во-первых, в XKB больше модификаторов и их поведение может гибко  перестраиваться. Поэтому, как уже упоминалось, для совместимости модулю  XKB приходится поддерживать восемь &quot;традиционных&quot; модификаторов и  осуществлять отображение (преобразование) своих модификаторов в  &quot;традиционные&quot;.
      <p> Более того. XKB вынужден поддерживать &quot;традиционный&quot; формат &quot;сообщения о  нажатии/отпускании&quot; клавиши, в котором передается &quot;состояние&quot; клавиатурного  модуля, состоящее из набора реальных модификаторов. Даже если модуль XKB  общается с XKB-совместимой Xlib, он вынужден, для передачи ей информации  о состоянии своих виртуальных модификаторов, &quot;превращать&quot; их в реальные. <br/>
        (Поэтому, кстати, виртуальный модификатор не оказывает никакого эффекта,  если он не &quot;отображен&quot; в какой-нибудь реальный). </p>
    </li>
    <li> Во-вторых, в core protocol &quot;номер группы&quot; имеет другой смысл.   Как уже говорилось - групп всего две, переключаются они символом <strong>Mode_Switch</strong> и в &quot;состоянии клавиатуры&quot; переключение на  &quot;дополнительную&quot; группу отображается одним из модификаторов <strong>Mod1-Mod5</strong> -  тем, который связан с символом <strong>Mode_Switch</strong>.
      <p> Таким образом, в &quot;традиционном&quot; протоколе номер группы отображается  одним из модификаторов - &quot;основная группа/альтернативная группа&quot;,  а в модуле XKB, в &quot;состоянии клавиатуры&quot; явно существует двухбитное  поле - &quot;номер группы&quot; (которое, к тому же, не &quot;перекрывается&quot; с набором  модификаторов). </p>
      <p> Кроме того, в &quot;традиционном&quot; модуле клавиатуры каждая группа состоит  ровно из двух &quot;уровней&quot;. Хотя при этом допускается, что каждому скан-коду  может быть сопоставлен одномерный массив символов длиной до 256. Первые  четыре ячейки в нем соответствуют &quot;двум группам, в каждой по два уровня&quot;.  Остальные ячейки &quot;клиентская&quot; программа может выбирать сама, в зависимости  от состояния модификаторов Mod1-Mod5. </p>
      <p> Поэтому, для совместимости модуль XKB, при общении со &quot;старыми&quot; программами,  вынужден ... </p>
      <ul>
          <li>Во-первых, &quot;размазывать&quot; свои подтаблицы-группы в одну строчку  &quot;традиционной&quot; таблицы символов (честно говоря, я так и не понял общий  алгоритм этого действия, кроме тривиального случая, когда скан-коду  соответствует две группы, каждая из двух уровней). </li>
        <li>Во-вторых, отображать свой &quot;номер группы&quot; в состояние какого-нибудь  &quot;реального&quot; модификатора. </li>
      </ul>
    </li>
    <li> Наконец, в core-модуле отсутствуют &quot;действия&quot; - основной механизм,  обеспечивающий &quot;гибкость поведения&quot; XKB. В связи с этим возникает  проблема - &quot;старая&quot; программа может поменять &quot;привязку&quot; символов к скан-кодам,  но, поскольку она не подозревает о том, что к скан-кодам могут быть  &quot;привязаны&quot; также и &quot;действия&quot;, может возникнуть ситуация, когда такая  программа переместить, например, символ &quot;переключатель РУС/ЛАТ&quot; на другую  клавишу, а соответствующее &quot;действие&quot; (которое в XKB реально осуществляет  это переключение) останется на старом месте.
      <p> Для решения этой проблемы в XKB хранится таблица &quot;интерпретаций&quot;  (<strong>interpretation</strong>) управляющих символов. Эта таблица связывает коды  символов и вызовы соответствующих &quot;действий&quot; (<strong>actions</strong>). Естественно,  в этой таблице присутствуют только специальные &quot;управляющие&quot; символы  ( <strong>Caps_Lock, Shift, Num_Lock, &quot;переключатель РУС/ЛАТ&quot;</strong> и т.п.). </p>
      <p> Кроме самих символов и &quot;действий&quot; в таблице интерпретаций хранится также  дополнительная информация - список &quot;реальных модификаторов&quot; и &quot;критерий  соответствия&quot; (&quot;любой из модификаторов&quot;, &quot;все указанные модификаторы&quot;,  &quot;только указанные модификаторы&quot; и т.п.). </p>
      <p> Каждый раз при изменении &quot;привязки&quot; символа (учтите, что это изменение  может происходить при старте X-сервера, как часть &quot;начальной настройки&quot;  сервера) модуль XKB проверяет - присутствует ли в этот символ в &quot;таблице  интерпретаций&quot;. И если символ там есть, то XKB, &quot;присвоив&quot; этот символ  требуему скан-коду, добавляет этому скан-коду и соответствующее &quot;действие&quot;.  Дополнительная информация (модификаторы и &quot;критерий соответствия&quot;) тоже  может использоваться при &quot;поиске&quot; подходящего места для &quot;действия&quot;. </p>
      <p> Кроме того, применение &quot;интерпретации&quot; может поменять некоторую другую  информацию, связанную со скан-кодом - флаги, отвечающие за &quot;автоповтор&quot;  и &quot;залипание&quot; клавиши и &quot;список виртуальных модификаторов&quot;. </p>
      <p> Напомню, что у каждого скан-кода может быть указан набор &quot;исключений&quot;,  который защитит информацию, связанную со скан-кодом от применения  &quot;интерпретации&quot;. </p>
      <p> Надо отметить, что помещать все &quot;действия&quot; в &quot;таблицу интерпретаций&quot;,  а не присваивать их непосредственно скан-кодам - является &quot;хорошим тоном&quot;.  Поскольку в &quot;таблице интерпретаций&quot; &quot;действие&quot; связывается с символом,  а не со скан-кодом, и, к тому же, &quot;перенос&quot; &quot;действий&quot; из &quot;таблицы  интерпретаций&quot; в соответствуюшие таблицы &quot;действий&quot; скан-кодов XKB выполняет  каждый раз при загрузке конфигурации (в том числе и при старте X-сервера),  модуль XKB сам найдет подходящее место для соответствующего &quot;действия&quot;  и, таким образом, корректно &quot;свяжет&quot; символы и действия (в таблицах,  назначенных скан-кодам). </p>
    </li>
  </ul>
  <h2>Еще несколько определений.</h2>
  <h3><a name="radio" id="radio">Радио-группы. (Radio Groups)</a></h3>
  <p> Модуль XKB позволяет объединять несколько клавиш в &quot;радио-группу&quot;.  То есть, клавиши одной ради-огруппы являются взаимозависимыми.  При нажатии одно из клавиш группы все остальные из этой группы &quot;отжимаются&quot;. </p>
  <p> Естественно, нажатая клавиша остается &quot;залипшей&quot;, пока не будет нажата  другая клавиша из этой группы. Принадлежность конкретной клавиши к  некоторой радио-группе задается в поле &quot;поведение клавиши&quot;. </p>
  <p> Там же можно определить дополнительное свойство - можно ли &quot;отжать&quot;  все клавиши радио-группы. Обычное определение радио-группы подразумевает,  что одна из клавиш группы должна быть нажата, а чтобы отжать ее, надо нажать  другую клавишу в группе (естественно, теперь она будет &quot;залипшей&quot;).  Если задано свойство &quot;могут быть отжаты все&quot;, то &quot;залипшую&quot; клавишу группы  можно &quot;отжать&quot; просто повторным нажатием (при этом никакая другая клавиша  группы не окажется &quot;залипшей&quot;). </p>
  <p> В XKB можно объявить до 127 радио-групп (хотя это может зависить от  конкретной реализации XKB). </p>
  <h3><a name="overlay" id="overlay">Перекрытия (Overlay).</a></h3>
  <p> В модуле XKB можно для некоторых клавиш (группы клавиш) задать набор  &quot;альтернативных&quot; скан-кодов. То есть, при нажатии такой клавиши клавиатура  выдает некоторый скан-код, который и должен быть интерпретирован XKB  (выбрать подходящий символ), но, если включен режим замены скан-кода  на &quot;альтернативный&quot;, то XKB прежде всего заменяет этот скан-код  соответствующим &quot;альтернативным&quot;, а потом уже новый скан-код пытается  интерпретировать. </p>
  <p> Такая группа называется &quot;перекрытием&quot; (<strong>overlay</strong>). Их может быть всего  две. Принадлежность конкретной клавиши к конкретной группе-&quot;перекрытию&quot;  и &quot;альтернативный&quot; скан-код задаются в поле &quot;поведение клавиши&quot;. </p>
  <p> Это свойство используется для клавиатур, у которых очень маленький  набор клавиш (например в &quot;лаптопах&quot;). Например, на такой клавиатуре  может полностью отсутствовать &quot;дополнительная цифровая клавиатура&quot;  (<strong>keypad</strong>). Поскольку некоторые приложения могут потребовать, чтобы  какие-то действия в них вызывались нажатием кнопок именно на <strong>keypad</strong>,  модуль XKB может эмулировать эту дополнительную клавиатуру, используя,  например, &quot;цифровые&quot; кнопки на основной клавиатуре. </p>
  <h3> <a name="accessx" id="accessx">AccessX.Дополнительные услуги для людей с ограниченными      физическими возможностями.</a></h3>
  <p> Имеются ввиду люди у которых подвижность рук (пальцев) ограничена или  они вынуждены пользоваться какими-либо маханическими приспособлениями  для работы с клавиатурой. </p>
  <p> Проблемы, которые могут возникнуть при этом: </p>
  <ul>
    <li> Невозможно нажимать одновременно несколько клавиш (например <strong>Shift</strong>+&quot;буква&quot;). Для решения этой проблемы в XKB предусмотрен режим <strong>StickyKeys</strong> (&quot;прилипающие клавиши&quot;). В этом режиме вместо одновременного нажатия  нескольких клавиш можно нажимать их последовательно. Например, вместо <strong>Shift+Control+C</strong> можно последовательно нажать клавиши <strong>Shift</strong>, <strong>Control</strong> и <strong>C</strong>.  Обратие внимание - не все клавиши должны &quot;слипаться&quot;. Правило здесь простое -  если клавиша является модификатором и без других кнопок ее нажатие не имеет  смысла, то после нажатия такой клавиши XKB ждет нажатия других клавиш, чтобы  &quot;слепить&quot; в одно событие. Если и последующие кнопки являются модификаторами  (как <strong>Control</strong> после <strong>Shift</strong> в нашем примере), то XKB остается в  состянии ожидания.  И только после нажатия обычной (буквенной клавиши) генерируется <strong>event</strong> и XKB возвращается в нормальное состяние. <br/>
      Кроме того заметьте, что этот режим сам может вызвать проблему если  клавиша модификатор нажата по ошибке. Любое следующее нажатие вызовет не то  действие, которое хотелось бы. Поэтому в режиме <strong>StickyKeys</strong> предусмотрена  специальная задержка (это настраиваемый параметр) в течении которой XKB ждет  следующую клавишу. Если за это время другого нажатия не последовало, то  клавиша отпускается. </li>
    <li> &quot;Дребезг&quot; клавиши при нажатии. Для решения этой проблемы в XKB  предусмотрен режим <strong>BounceKeys</strong> (&quot;прыгающие клавиши&quot;). В этом режиме после  первого нажатия на клавишу XKB на некоторое время становится  &quot;нечувствительным&quot;, то есть не обращает внимание на изменение состяния  клавиши и таким образом игнорирует лишние нажатия. Естественно интервал  времени &quot;нечувствительности&quot; можно менять. </li>
    <li> Ошибочное &quot;задевание&quot; клавиш. Имеется ввиду, что человек при  перемещении руки от одной клавиши к другой может случайно задеть несколько  клавшь, которые нажимать не собирался. Для решения этой проблемы предусмотрен  режим <strong>SlowKeys</strong> (&quot;медленные клавиши&quot;). Смысл его в том, что клавиша считается  реально нажатой если она остается в таком состоянии некоторое время  (опять же это время можно настраивать). Другими словами, если клавишу нажать  и быстро отпустить, то XKB игнорирут такое скоротечное нажатие. </li>
    <li> Невозможность управлять &quot;мышью&quot;. Для решения этой проблемы в XKB  предусморена возможность эмулировать события мыши с помощью клавиатуры.  Подробнее об этом режиме мы поговорим <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#mouse">ниже</a>. </li>
  </ul>
  <p> Все эти режимы осуществляются частью XKB модуля, которая называется  AccessX. Все режимы можно включать и выключать по отдельности изменяя состяние  одноименных &quot;управляющих флагов XKB&quot; (XKB Controls). </p>
  <p> Обратите внимание, что само включение режимов AccessX может быть проблемой.  (Представьте себе, что человеку нужен режим <strong>StickyKeys</strong>, а для его активизации  нужно нажать сложную комбинация из нескольких клавиш). Поэтому для включения  некоторых режимов используются специальные действия: </p>
  <ul>
    <li> Если нажать клавишу <strong>Shift</strong> и удерживать ее нажатой в течении 8 секунд,  то включается режим <strong>SlowKeys</strong>. </li>
    <li> Если нажать тот же <strong>Shift</strong> пять раз подряд, то включется режим <strong>StickyKeys</strong>. </li>
  </ul>
  Правда для этого должен быть включен режим распознавания таких  &quot;магических последовательностей&quot; (<strong>AccessXKeys</strong>). Его можно включить
  <ul>
    <li> либо указав соответствующий ключ при запуске X-сервера, </li>
    <li> либо установив нужный флаг в &quot;файле конфигурации XKB&quot;, </li>
    <li> или включить тот же флаг с помощью клавиши с нужным <strong>action</strong> (по умолчанию такой клавиши нет, но ее можно предусмотреть в раскладке  клавиатуры). </li>
  </ul>
  <p> С другой стороны, если один из режимов AccessX включен, а компьютер  используется разными пользователями, то человку не имеющему ограничений  он может наоборот мешать. Поэтому в XKB предусмотрено автоматическое  отключение режимов AccessX, если в течении некоторого времени клавиатура  никак не использовалась. Кроме того, режим <strong>StickyKeys</strong> (эмуляция одновременного  нажатия через последовательное) автоматически выключиться, если вы нажмете  несколько клавиш действительно одновременно. <br/>
    Саму возможность автоматического выключения AccessX по таймауту можно  (как и другие режимы) включить/выключить соответствующим флагом   (<strong>AccessXTimeout</strong>) в XKB Controls. <a name="accessxfeedback" id="accessxfeedback"></a> </p>
  <p> И наконец - в AccessX предусмотрен дополнительный режим звуковой индикации  всех происходящих событий - начало и окончание всевозможных таймаутов, а также  включение и выключение LED'ов. Для того, чтобы лучше ориентироваться в  этх событиях (особенно если включено несколько разных режимов AccessX) XKB  старается озвучивать их звуками разной длительности и тона (насколько позволяет  &quot;железо&quot;). <br/>
    Этот режим, как и другие может быть включен/выключен соответсвующим  флагом (<strong>AccessXFeedback</strong>) в XKB Controls. Кроме того, можно по отдельности  включить/выключить озвучивание отдельных событий. </p>
  <h3><a name="mouse" id="mouse">Эмуляция &quot;мыши&quot;</a></h3>
  <p> XKB может эмулировать события мыши с помощью клавиатуры. То есть, его  можно настроить так, что при нажатии определенных клавиш X-сервер будет  посылать приложению сообщения (<strong>events</strong>) не о нажатии/отжатии кнопок,  а о перемещении мыши и нажатии кнопок на мышке. </p>
  <p> Делается это с помощью соответсвующих <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#actions">действий</a> (<strong>actions</strong>) - перемещение мыши, нажатие кнопки мыши, выбор кнопки  &quot;по умолчанию&quot;. </p>
  <p> Рассмотрим их немного подробнее. </p>
  <ul>
    <li> В <strong>action</strong> &quot;перемещение&quot; можно задавать сразу обе координаты (или их  приращения). Координаты могут быть как абсолютные (это означает, что при  выполнении такого действия указатель мыши должен встать в заданную точку  экрана), так и относительные - собственно перемещение на несколько точек  в нужном направлении. Обычно для удобства делают несколько разных <strong>action</strong> для одного направления, но с разными приращениями - на одну точку, на десять  точек и т.д. Эти <strong>action</strong> можно привязать к одной кнопке, но в разных  уровнях. Получится, что при обычном нажатии кнопки указатель смещается,  на одну точку, а нажатие той же кнопки с Shift'ом перемещение будет на  несколько точек при одном нажатии. </li>
    <li> В <strong>action</strong> &quot;нажатии кнопки мыши&quot; можно кроме самой кнопки указать  и число повторов. То есть, одиночное нажатие клавиши может эмулировать  &quot;двойной клик&quot; (или тройной, четверной и т.п.). </li>
    <li> Кроме того, существует разновидность этих действий, которая не просто  &quot;нажимает кнопку мыши&quot; по нажатии клавиши, а оставляет ее нажатой  после отпускания клавши (как все <strong>Lock</strong> клавши). То есть, вы можете с помощью  такого действия &quot;прижать кнопку мыши&quot;, переместить указатель и повторным  нажатием клавиши &quot;отпустить кнопку мыши&quot;. Естественно, это выглядит так, как  будто вы двигали реальную мышь с нажатой кнопкой. </li>
    <li> И наконец, обратите внимание, что кнопок  мыши может быть до пяти,  а с учетом &quot;многократных кликов&quot; и Lock'ирующих нажатий может получится, что  под &quot;мышинные кнопки&quot; придется занять довольно много клавиш. Для того, чтобы  сократить это количество в XKB предусмотрено, что одну из кнопок можно  объявить &quot;кнопкой по умолчанию&quot; (<strong>default button</strong>). Для такого назначения и его  изменения предусмотрены специальные действия, в которых можно опять же указать,  как конкретную кнопку (по номеру), так и относительное изменение номера  &quot;кнопки по умолчания&quot;. Комбинируя эти действия, можно одной клавишей перебирать  циклически кнопки (делая их по очереди &quot;умолчательными&quot;), а в действиях  &quot;нажимающих&quot; кнопки указать, что они относятся к той кнопке, которая сейчас  выбрана как <strong>default button</strong>. (Проблема только в том, как не запутаться и не  забыть - какая кнопка сейчас выбрана :-) </li>
  </ul>
  <p> Кроме того, существует два режима (<strong>mode</strong>) перемещения мыши - простой  и &quot;с ускорением&quot; (<strong>accelerated</strong>). При одиночном нажатии клавиши разница между  ними незаметна. А вот если вы держите клавишу нажатой и работает автоповтор,  тот в обычном режиме на каждый автоповтор указатель смещается на одно и то  же количество точек (заданое в аргументах действия). А в <strong>accelerated mode</strong> указатель начинает ускоряться, то есть с каждым новым автоповтором размер  одиночного шага растет. </p>
  <p> Весь процесс ускорения описывается несколькими дополнительными параметрами,  которые хранятся во внутренних переменных XKB (являются частью &quot;состояния&quot;  XKB). (Надо заметить, что режим ускорения имеет свои параметры автоповтора -  задержку между реальным нажатием клавиши и первым повтором и интервал между  повторорами.) Итак, эти параметры (числовые) описывают </p>
  <ul>
    <li><strong>delay</strong> - интервал (в миллисекундах) от нажатия клавиши  (эмулирующей движение мыши) до первого автоповтора. </li>
    <li><strong>interval</strong> - интервал (в миллисекундах) между повторами </li>
    <li><strong>maxspeed</strong> - максимальная скорость (в точках на один  повтор) </li>
    <li><strong>timetomax</strong> - количество повторов, за которое достигается  максимальная скорость движения. Как видите, здесь нет в явном виде величины  ускорения. XKB сам вычисляет его из начальной величины смещения (задается  в конкретном действии), <strong>maxspeed</strong> и <strong>timetomax</strong>. </li>
    <li><strong>curve</strong> - &quot;степень кривизны&quot; ускорения. Дело в том, что скорость  может расти не линейно. В общем виде приращение скорости пропорционально  функции <strong>X^(1 + curve/1000)</strong>. То есть, при curve=0 скорость растет линейно,  а при других значениях (от -1000 до +1000) с некоторой &quot;кривизной&quot;. </li>
  </ul>
  По умолчанию используется именно режим с ускорением.
  <p> Включение и выключение эмуляции мыши и выбор режима движения выбирается  двумя <a href="https://web.archive.org/web/20190509083229/http://pascal.tsu.ru/other/xkb/internals.html#controls">управляющими флагами XKB (XKB Controls)</a> - <strong>MouseKeys</strong> и <strong>MouseKeysAccel</strong>. </p>
  <p> Надо заметить, что по умолчанию все нужные действия описаны и привязаны  к кнопкам &quot;дополнительной цифровой клавиатуры&quot; (<strong>NUMPAD</strong>). Для включения и  выключения режима эмуляции мыши используется комбинация <strong>Shift+NumLock</strong>. </p>
  <h3><a name="bell" id="bell">Расширенные возможности &quot;пищалки&quot; (Bell).</a></h3>
  <p> Вообще-то, эта часть XKB имеет малое отношение к клавиатуре. <br/>
    Более того, для пользователей компьютеров, в которых клавиатура, дисплей  и &quot;спикер&quot; - независимые устройства, такое совмещение может показаться очень  странным. Но поскольку, в некоторых архитектурах динамик &quot;пищалки&quot; находится  в клавиатуре и издает звук (<strong>key_click</strong>) при каждом нажатии клавиши,  в &quot;иксах&quot; считается, что управление &quot;пищалкой&quot; - дело клавиатурного модуля. </p>
  <p> Надо отметить, что управление &quot;пищалкой&quot; заложено еще в традиционном (core)  модуле клавиатуры. С помощью стандартных запросов к X-серверу, приложение  может регулировать параметры <strong>key_click</strong>'а (высоту тона, длительность и  громкость), а также вызвать этот <strong>click</strong> при необходимости. </p>
  <p> В XKB разработчики пошли еще дальше и предусмотрели возможность вместо  простого &quot;писка&quot; проигрывать &quot;музыкальные фрагменты&quot;. Естественно,  обеспечить такое &quot;музыкальное сопровождение&quot; для клавиатурного модуля слишком  сложная задача. Во-первых нужна &quot;база данных&quot; различных звуков (хотя бы просто  в виде набора аудио-файлов), а во-вторых музыка может воспроизводится  различными &quot;железками&quot; (звуковыми картами), каждая из которых требует  &quot;особого подхода&quot; (драйвера). </p>
  <p> Поэтому, по замыслу разработчиков, выбором конкретного звука и его  воспроизведением должна заниматься отдельная программа (назовем ее -  &quot;музыкальная приставка&quot;). А модуль XKB вместо &quot;писка&quot; просто генерирует  специальное сообщение (<strong>event</strong>), которое так же как и обычные <strong>event</strong>'ы  X-сервера могут быть доставлены любой программе. &quot;Музыкальная приставка&quot;  только должна при старте сообщить X-серверу, что ее интересует определенная  разновидность <strong>event</strong>'ов (в данном случае - <strong>bell-event</strong>'ы от модуля XKB). </p>
  <p> Естественно, если такая &quot;музыкальная приставка&quot; существует, ее возможности  не ограничиваются воспроизведением &quot;писков&quot; разной частоты и длительности.  Она может проигрывать множество разных музыкальных фрагментов из своей  &quot;базы данных&quot;. <br/>
    Поэтому, в сообщениях XKB указывается не &quot;параметры писка&quot;, а просто  некое &quot;имя звука&quot; (<strong>bell name</strong>). Естественно, &quot;музыкальная приставка&quot;  должна иметь какой-то конфигурационный файл, в котором для каждого  &quot;имени звука&quot; назначен свой музыкальный фрагмент. </p>
  <p> Соответственно, теперь любое приложение с помощью соответствующих  запросов к X-серверу (теперь уже не в core-формате, а в формате XKB),  может заказать не просто &quot;писк&quot; с определенным тоном и длительностью,  а любой звук, указав его имя (<strong>bell name</strong>). </p>
  <p> При этом XKB собственно является просто &quot;ретранслятором&quot;. Он даже не  анализирует правильность &quot;имени звука&quot;, а просто, получив запрос от любого  приложения, передает его в виде своего <strong>event</strong>'а &quot;музыкальной приставке&quot;. </p>
  <p> Естественно, в такой схеме XKB кажется даже лишним. Приложение могло бы  и само общаться с &quot;музыкальной приставкой&quot;. Но не забудьте, что сама идеология  &quot;иксов&quot; допускает, что приложение, X-сервер и &quot;музыкальная приставка&quot;  могут быть запущены на различных машинах. Поэтому, нормальное приложение  должно было бы, кроме соединения с X-сервером, найти еще и &quot;музыкальную  приставку&quot; и установить с ней контакт. </p>
  <p> В схеме с XKB, любое приложение отправляет свои запросы тому же самому  X-серверу (с которым ему и так приходится общаться), а уж администратор  сервера определяет - кто и как будет обслуживать эти запросы. Кроме того,  при этом вводится некоторый стандарт на общение между приложением и  &quot;звуковой приставкой&quot; (разве что, кроме самих &quot;имен звуков&quot;). </p>
  <p> Надо заметить также, что XKB не только ретранслирует запросы, но и сам может  &quot;заказать звук&quot; при некоторых изменениях своего внутреннего состояния  (состояния индикаторов, флагов и т.п.). </p></td>
<td width="200" class="links" valign="top" align="left" style="padding-top:150px;">
 
</td>
</tr>
</table>
<div id="copyright">&copy; <a href="https://web.archive.org/web/20190509083229/mailto:pascal@tsu.ru">Иван Паскаль</a></div>
</body>
</html>
<!--
     FILE ARCHIVED ON 08:32:29 May 09, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 18:16:57 Aug 11, 2022.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 77.738
  exclusion.robots: 0.198
  exclusion.robots.policy: 0.191
  cdx.remote: 0.065
  esindex: 0.01
  LoadShardBlock: 51.195 (3)
  PetaboxLoader3.datanode: 93.694 (4)
  CDXLines.iter: 14.926 (3)
  load_resource: 93.434
  PetaboxLoader3.resolve: 38.642
-->
