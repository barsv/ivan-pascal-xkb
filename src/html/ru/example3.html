<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app226.us.archive.org';v.server_ms=369;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="/_static/js/bundle-playback.js?v=KTqwAcYd" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=UHAOicsW" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://pascal.tsu.ru:80/other/xkb/example3.html","20190622030203","https://web.archive.org/","web","/_static/",
	      "1561172523");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=fantwOh2" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->

<meta http-equiv="Content-Type" content="text/html; charset=windows-1251"/>
<title>Ivan Pascal (Homepage)</title>
<style type="text/css" media="all">@import url(/web/20190622030203cs_/http://pascal.tsu.ru/css/style.css);</style>
</head>
<body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20190622030203/http%3A//pascal.tsu.ru/other/xkb/example3.html"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://pascal.tsu.ru/other/xkb/example3.html" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20190622030203" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
		<div class="s" id="wm-nav-captures" style="flex:1;">
	  	  <a class="t" href="/web/20190622030203*/http://pascal.tsu.ru/other/xkb/example3.html" title="See a list of every capture for this URL">31 captures</a>
	  <div class="r" title="Timespan for captures of this URL">28 Dec 2003 - 25 Aug 2019</div>
	  </div>
	<div class="k">
	  <a href="" id="wm-graph-anchor">
	    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
	      <canvas id="wm-sparkline-canvas" width="675" height="27" border="0"></canvas>
	    </div>
	  </a>
	</div>
      </div>
    </div>
    <div class="n">
      <table>
	<tbody>
	  <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
	  <tr class="m">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190421161131/http://pascal.tsu.ru:80/other/xkb/example3.html" title="21 Apr 2019"><strong>Apr</strong></a></td>
	    <td class="c" id="displayMonthEl" title="You are here: 03:02:03 Jun 22, 2019">JUN</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20190725061227/http://pascal.tsu.ru:80/other/xkb/example3.html" title="25 Jul 2019"><strong>Jul</strong></a></td>
	  </tr>
	  <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
	  <tr class="d">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190522071033/http://pascal.tsu.ru:80/other/xkb/example3.html" title="07:10:33 May 22, 2019"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
	    <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 03:02:03 Jun 22, 2019">22</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20190725061227/http://pascal.tsu.ru:80/other/xkb/example3.html" title="06:12:27 Jul 25, 2019"><img src="/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
	  </tr>
	  <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
	  <tr class="y">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20171008034503/http://pascal.tsu.ru:80/other/xkb/example3.html" title="08 Oct 2017"><strong>2017</strong></a></td>
	    <td class="c" id="displayYearEl" title="You are here: 03:02:03 Jun 22, 2019">2019</td>
	    <td class="f" nowrap="nowrap">2020</td>
	  </tr>
	</tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
        	<span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
	</span>
        	<a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20190622030203/http://web.archive.org/screenshot/http://pascal.tsu.ru/other/xkb/example3.html"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru:80/other/xkb/example3.html" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru:80/other/xkb/example3.html" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
	<a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20190622030203/http://pascal.tsu.ru:80/other/xkb/example3.html</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(675,27,25,2,"web","http://pascal.tsu.ru/other/xkb/example3.html","20190622030203",1996,"/_static/",["/_static/css/banner-styles.css?v=fantwOh2","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->

<div style="position:absolute; top:10; right:0; z-index:3"><img src="/web/20190622030203im_/http://pascal.tsu.ru/img/logo.jpg"/>
<div style=" font-size:11px;">
<a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/en/">ENGLISH</a> | 
<a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/">KOI</a> | 
<a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/win/">WIN</a> | 
<a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/alt/">ALT</a> | 
<a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/iso/">ISO</a></div>
</div>

<div id="head"><h2>Иван Паскаль</h2>
<div class="anotation">
Этот сайт посвящен описанию Операционной Системы
<noindex><a href="https://web.archive.org/web/20190622030203/http://www.freebsd.org/">FreeBSD</a></noindex> (одна из разновидностей Unix). 
<br/>
Я его сделал для того, чтобы хоть немного восполнить недостаток
документации, особенно на русском языке.<a href="unix"> Полная "Table of Contents"</a>
</p>
</div>
</div>


<table width="100%">
<tr>
<td width="300" valign="top">

<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/add/adding.html">Добавление компонент из дистрибутива</a></div>
	<ul>
		<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/add/packages.html">Установка "пакетов" (packages)</a></li>
		<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/add/ports.html">Установка "портов" (ports)</a></li>
		<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/add/sysinst.html">С помощью программы sysinstall</a></li>
		<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/add/manualy.html">Установка "вручную"</a></li>
	</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users0.html">Работа администратора с user account</a></div>
<ul>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users1.html">Что такое &quot;учетная карточка&quot;?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users2.html">Что  хранится в учетной карточке?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users3.html">Для чего используется учетная карточка?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users4.html">Где хранятся учетные карточки?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users5.html">Добавление пользователя</a></li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users6.html">Редактирование данных учетной карточки?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users7.html">Удаление пользователя</a></li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users8.html">Права пользователя на учетную карточку</a></li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users9.html">Временная блокировка пользователя</a></li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/users10.html">Что еще почитать?</a> </li>
</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/groups.html">Группы (пользователей)</a></div>
<ul>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/groups1.html">Что такое группа?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/groups2.html">Где хранится информация о группах?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/groups3.html">Колличество групп, юзеров в группе, групп у юзера</a></li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/groups4.html">Как создать или удалить группу?</a> </li>
  <li> <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/users/groups5.html">Редактирование принадлежности юзера к группе</a> </li>
</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files1.html">Права доступа к файлам</a></div>
<ul>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files2.html">Какие атрибуты файла определяют &quot;право доступа&quot;.</a></li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files3.html">Основные биты доступа (чтение/запись/выполнение)</a> </li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files4.html">Дополнительные биты доступа</a> </li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files5.html">&quot;Странные&quot; сочетания битов доступа.</a> </li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files6.html">Флаги.</a> </li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files7.html">С какими правами файл &quot;рождается&quot;</a> </li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files7a.html">Права после копирования или перемещения</a></li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files8.html">Как поменять права </a></li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/files/files9.html">Что делать если этого не хватает?</a> </li>
</ul>
</div>
<div id="block">
<div class="title"><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/syscons.html">Драйвер "системной консоли" - syscons</a></div>
<ul>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/main.html">Основные возможности syscons</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/screen.html">Дисплей</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/keyboard.html">Клавиатура</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/kbd-examples.html">Примеры изменения назначения клавиш.</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/vidcontrol.html">Программа vidcontrol</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/kbdcontrol.html">Программа kbdcontrol</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/russian.html">Русификация syscons</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/termcap.html">&quot;Взаимопонимание&quot; программ с терминалом </a></li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/XWin.html"> Какое отношение это имеет к X-Window?</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/ansi.html">Команды (esc-последовательности) syscons</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/app2.html">Управляющие (&quot;контроловые&quot;) символы</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/app3.html">&quot;Функциональные&quot; клавиши</a> </li>
  <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/syscons/app4.html">Несколько мелких полезных программок.</a> </li>
</ul>
</div>
<div id="block">
<div class="title">Разное</div>
<ul>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/unix/lint/rebuild.html">Перегенерация ядра системы (kernel)</a></li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/frames.html">Фреймы Ethernet.</a></li>
	<li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/">XKB - "клавиатурный модуль" X-Window.</a></li>
</ul>
</div>
<div id="block">
<div class="title">Мои программы</div>
<ul>
	<li><a href="other/xxkb/">Xxkb</a> (для модуля XKB)</li>
	<li><a href="other/xxkb/README">README</a> и <a href="other/xxkb/CHANGES">CHANGES</a>.</li>
</ul>
</div>
</td>

<td class="content" valign="top" align="left"><h2>&quot;Вариации на тему&quot; переключатели &quot;рус/лат&quot; (и еще раз - &quot;рус&quot;).</h2>


      <ul>
        <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/example3.html#1">Первый способ - простой и неудобный.</a> </li>
        <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/example3.html#2">Второй способ (через модификатор).</a> </li>
        <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/example3.html#3">Третий способ (через дополнительную переменную номера группы).</a> </li>
        <li><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/example3.html#final">&quot;Заключительный аккорд&quot; - &quot;отцепляемся&quot; от скан-кодов.</a> </li>
      </ul>
      <p> Предположим, что вы выполнили предыдущий пример или еще откуда-нибудь  взяли (сделали) раскладку клавиатуры с тремя группами. </p>
      <p> И вам не нравится способ переключения между группами - три положения  у одного переключателя &quot;лат/рус/рус&quot;. </p>
      <p> </p>
      <h4>Что можно сделать?</h4>
      <p> Ну, во-первых, давайте вообще забудем пока про символ <strong>ISO_Next_Group</strong>,  к которому &quot;прицеплено&quot; такое неудобное &quot;действие&quot;. (Вообще-то, семантику <strong>ISO_Next_Group</strong> можно и переделать, но пока отложим этот вопрос). </p>
      <p> Для простоты рассмотрения будем считать, что переключение у вас делается  одной клавишей (обычно - это <strong>CapsLock</strong>),а не комбинацией клавиш (типа - <strong>Shift+Shift</strong> или <strong>Alt+Shift</strong>). </p>
      <p> Напомню, что непосредственно в описании клавиши можно указать &quot;действия&quot;,  причем, разные для разных групп. </p>
      <p> Кстати. Напомню, что, во-первых, большинство  изменений мы будем делать  в файле типа <strong>xkb_symbols</strong>. А, во-вторых, поскольку эти изменения не просто  дополняют существующие определения клавиш, а изменяют их радикально, то  лучше всего добавлять их в &quot;общую конфигурацию&quot; не &quot;приплюсовыванием&quot;,  а отдельной инструкцией <strong>replace</strong>, например - </p>
      <p>xkb_symbols {	include &quot;en_US(pc104)&quot;  		replace &quot;new.symbols&quot; };  </p>
(Вообще-то, можно &quot;способ добавления&quot; <strong>replace</strong> указывать в файле перед каждой  инструкцией. Но это, почему-то, не всегда срабатывает.)
<h3><a name="1" id="1">Первый способ - простой и неудобный.</a></h3>
<p> Самый тривиальный способ - сделать две клавиши-переключатели, каждая с двумя  состояниями. Одна клавиша переключает <strong>&quot;лат./старый рус.&quot;</strong>, другая - <strong>&quot;лат/новый рус.&quot;</strong>. Или в терминах &quot;номер группы&quot;, первая клавиша переключает <strong>&quot;group1/group2&quot;</strong>, другая - <strong>&quot;group1/group3&quot;</strong>. </p>
<p> Выберем два скан-кода и &quot;подвесим&quot; на них &quot;действия&quot; - </p>
<p>key &lt;...&gt; { actions[Group1]= [ LockGroup(group=2) ],  	    actions[Group2]= [ LockGroup(group=1) ] };    key &lt;...&gt; { actions[Group1]= [ LockGroup(group=3) ],  	    actions[Group3]= [ LockGroup(group=1) ] };    </p>
<p> Конечно, это - неполное описание. Надо добавить к первой клавише ее &quot;поведение&quot;,  когда включена группа 3, на тот случай, если мы нажмем ее в ситуации, когда с  помощью второго переключателя уже выбрана третья группа. И, соответственно,  &quot;поведение&quot; второй клавиши в состоянии &quot;группа 2&quot;. </p>
<p> Кроме того, в описании должна быть кроме таблицы &quot;действий&quot; еще и таблица  символов. В нашем случае можно использовать специальный &quot;псевдосимвол&quot; - <strong>NoSymbol</strong>. </p>
<p> Тогда полное описание будет выглядеть как </p>
<p>key &lt;...&gt; { [NoSymbol],[NoSymbol],[NoSymbol],  	    actions[Group1]= [ LockGroup(group=2) ],  	    actions[Group2]= [ LockGroup(group=1) ],  	    actions[Group3]= [ LockGroup(group=1) ] };    key &lt;...&gt; { [NoSymbol],[NoSymbol],[NoSymbol],  	    actions[Group1]= [ LockGroup(group=3) ],  	    actions[Group2]= [ LockGroup(group=1) ],  	    actions[Group3]= [ LockGroup(group=1) ] };  </p>
Но, на мой взгляд, такой способ переключения еще более неудобный.  (Я же не обещал &quot;хороших&quot; решений :-). <br/>
Поэтому, я его даже не пробовал и вам не предлагаю.
<h3><a name="2" id="2">Второй способ (через модификатор).</a></h3>
<p> Более удобным мне представляется способ, когда наш привычный перключатель  (пусть это будет <strong>CapsLock</strong>) продолжает переключать &quot;лат/рус&quot;. А вот - какой  именно &quot;рус&quot; (вторую или третью группу) он выберет - будет определяться  другой клавишей. </p>
<p> Естественно, при этом каждый из переключателей имеет два состояния.  Основной переключатель - &quot;лат/рус&quot;, дополнительный - &quot;группа2/группа3&quot;. </p>
<p> Другими словами, &quot;поведение&quot; основного переключателя должно меняться  в зависимости от того, нажимали ли мы дополнительный переключатель (и сколько  раз - четное или нечетное количество). </p>
<p> Собственно эти два &quot;поведения&quot; я уже написал в предыдущем примере.  Только там были две разные клавиши, а нам надо соместить это на одной.  Кстати, можно заметить, что эти два описания отличаются только  в одной строчке - &quot;переход из состояния Group1&quot;, остальные части описания  совпадают. </p>
<p> Итак. Подзадача - как сделать так, чтобы &quot;поведение&quot; клавиши менялось  в зависмости от состяния какой-нибудь другой. </p>
<p> Первое, что приходит в голову - с помощью какого-нибудь модификатора.  Напомню, что каждая группа может делиться на уровни (<strong>shift level</strong>),  а выбор конкретного уровня зависит от состояния модификаторов. Причем,  эту зависимость мы можем как угодно менять, сочиняя новые &quot;типы&quot; клавиш. </p>
<p> Все, что нам надо - взять какой-нибудь модификатор (виртуальный),  сочинить &quot;тип&quot;, в котором переход на второй уровень зависит только от данного  модификатора (чтобы наш основной перключатель реагировал только на этот  модификатор) и, наконец, разделить у нашего переключателя (основного)  первую группу на два уровня и &quot;присвоить&quot; им разные действия. </p>
<p> Естественно, &quot;установку/сброс&quot; модификатора &quot;повесить&quot; (с помощью  соответствующих &quot;действий&quot;) на второй переключатель. </p>
<p> Итак. Описание основного переключателя теперь будет иметь вид </p>
<p>key &lt;...&gt; { type[Group1]=&quot;.....&quot;,  	    [NoSymbol, NoSymbol], [NoSymbol], [NoSymbol],  	    actions[Group1]= [ LockGroup(group=2), LockGroup(group=3)],  	    actions[Group2]= [ LockGroup(group=1) ],  	    actions[Group3]= [ LockGroup(group=1) ] };  </p>
(&quot;тип&quot; придумаем немного позже).
<p> Теперь надо &quot;сочинить&quot; модификатор и новый тип. И здесь нас ждет &quot;засада&quot;.  Дело в том, что <strong>xkbcomp</strong> (по крайней мере в нынешнем состоянии) не позволяет  объявить новый виртуальный модификатор. Можно использовать только те, которые  в нем уже предопределены. </p>
<p> К счастью, среди его модификаторов уже есть подходящий - <strong>LevelThree</strong>.  А подходящий он потому, что </p>
<ul>
  <li> во-первых, он практически не используется (по крайней мере в &quot;русских&quot;  конфигурациях), </li>
  <li> а во-вторых, есть уже подходящий тип, с использованием этого модификатора,  и нам не придется его описывать. </li>
</ul>
<p> Таким образом, берем модификатор <strong>LevelThree</strong> и тип <strong>&quot;THREE_LEVEL&quot;</strong> - </p>
<p>type &quot;THREE_LEVEL&quot; {  	modifiers = Shift+LevelThree;  	map[None] = Level1;  	map[Shift] = Level2;  	map[LevelThree] = Level3;  	map[Shift+LevelThree] = Level3;  	level_name[Level1] = &quot;Base&quot;;  	level_name[Level2] = &quot;Shift&quot;;  	level_name[Level3] = &quot;Level3&quot;;  };  </p>
<p> Напомню, что он уже должен быть в нашей &quot;полной конфигурации&quot; по умолчанию.  Только обратите внимание, что он определяет не два, а три уровня. Причем,  &quot;наш&quot; модификатор &quot;посылает&quot; на третий уровень. Но ничего страшного в этом  нет. Мы просто сдвинем второе &quot;действие&quot; на третий уровень, а второй можно  заполнить &quot;заглушкой&quot; - <strong>NoAction()</strong> или сделать его таким же как и первый  уровнь (обратите внимание - второй уровень, это - когда прижат <strong>Shift</strong>). </p>
<p> Таким образом, наш основной переключатель (давайте уже определимся, что  это будет <strong>&lt;CAPS&gt;</strong>), приобретает вид </p>
<p>key &lt;CAPS&gt; { type[Group1]=&quot;THREE_LEVEL&quot;,  	[NoSymbol, NoSymbol, NoSymbol], [NoSymbol], [NoSymbol],  	actions[Group1]= [ LockGroup(group=2), NoAction(), LockGroup(group=3)],  	actions[Group2]= [ LockGroup(group=1)],  	actions[Group3]= [ LockGroup(group=1)] };  </p>
<p> Теперь можно заняться второй клавишей, которая будет &quot;поднимать/опускать&quot;  модификатор <strong>LevelThree</strong>. Конечно, это может быть не одиночная клавиша, а  какая-нибудь комбинация клавиш. Но для простоты, сначала возьмем отдельную  клавишу. Я на своей клавиатуре (&quot;Микрософтовской&quot;) использовал для этого  клавишу &quot;<strong>Menu</strong>&quot; (скан-код <strong>&lt;MENU&gt;</strong>). Но, если у вас такой клавиши нет, то  можно задействовать одну из парных клавиш (<strong>Shift, Control, Alt</strong>). </p>
<p> Итак. Сочиняем &quot;поведение&quot; клавиши <strong>&lt;MENU&gt;</strong>. <br/>
  Прежде всего - я думаю, что вам не хочется держать ее все время нажатой,  пока это нужно. То есть, нам надо, чтобы по первому нажатию она &quot;подняла&quot;  модификатор, а по второму - опустила. </p>
<p> Как раз это делает &quot;действие&quot; <strong>LockMods</strong> (в переменной <strong>locked modifiers</strong>).  Напомню, что <strong>SetMods</strong> и <strong>LatchMods</strong> &quot;держат&quot; модификаторы только пока нажата  клавиша. </p>
<p> Итак, используем &quot;действие&quot; <strong>LockMods</strong> - </p>
<p>key &lt;MENU&gt; 	{ [ NoSymbol ],  		actions[Group1]=[ LockMods(modifiers=LevelThree) ]};  </p>
(Описывать все три группы не обязательно. Если номер группы больше, чем  допустимо для клавиши, XKB будет его &quot;выравнивать&quot;, пока не попадет в  допустимый диапазон.)
<p> Теперь остается одна тонкость. Дело в том, что сам по себе виртуальный  модификатор работать не будет, если он не связан с каким-нибудь реальным  модификатором. Напомню, что при общении модуля XKB с процедурами Xlib,  передается только &quot;эмулируемый набор модификаторов&quot; (то есть - реальные  модификаторы). И, хотя выполнение &quot;действий&quot; происходит внутри модуля XKB,  а не в Xlib, чтобы не возникало &quot;разногласий&quot; между XKB и Xlib по поводу  &quot;состояния&quot;, необходимо &quot;связать&quot; виртуальный модификатор с каким-нибудь  реальным. </p>
<p> Поэтому, последним шагом будет - связать с клавишей какой-нибудь  реальный модификатор (с помошью объявления <strong>modifier_map</strong>). И вот здесь  нас ждет вторая &quot;засада&quot;. В полной конфигурации все модификаторы (даже  &quot;безымянные&quot; - <strong>Mod1-Mod5</strong>) уже расписаны. То есть, каждый уже соединен  с какой-нибудь клавишей и, соответственно, каким-нибудь символом. </p>
<p> Самое неприятное то, что клиентские приложения могут реагировать на эти  модификаторы и менять свое поведение. Поэтому, если мы свяжем наш <strong>LevelTree</strong>,  например, с модификатором <strong>Mod5</strong>, который соответствует символу <strong>Scroll_Lock</strong>,  то, при &quot;поднятии&quot; модификатора <strong>LevelThree</strong>, приложения будут считать, что  нажата кнопка <strong>ScrollLock</strong>. А вот как они будут вести себя при этом - кто как. </p>
<p> Здесь надо немного пояснить - как реагируют программы на &quot;безымянные&quot;  модификаторы. Поскольку этими модификаторам явно никакая функция не  соответствует, программы ориентируются на символы, которые с ними связаны. </p>
<p> То есть, если программа обнаружит, что в &quot;состоянии&quot; модификаторов  взведен модификатор <strong>Mod1</strong>, она попытается найти соответствующий ему  символ. Обычно это - <strong>Alt_L</strong> и <strong>Alt_R</strong>, то есть любая из клавиш <strong>Alt</strong>.  Соответственно, программа считает, что нажата клавиша <strong>Alt</strong> и ведет себя  в соответствии со своим пониманием этой клавиши. </p>
<p> Поэтому, чтобы избежать всяких &quot;побочных&quot; эффектов, нам надо не только  связать модификатор с нашей клавишей <strong>&lt;MENU&gt;</strong>, но и &quot;отцепить&quot; этот реальный  модификатор от других. Как я уже говорил в примере &quot;добавление новой группы&quot;,  &quot;отцепить&quot; модификатор, который был объявлен где-то &quot;в глубинах&quot; <strong>includ'ов</strong>,  очень трудно. но, к счастью, они там привязываются не к скан-кодам, а к  символам. Поэтому, если мы в своей конфигурации просто уберем эти символы  из описаний скан-кодов, то связка &quot;модификатор-символ&quot; просто &quot;повиснет  в воздухе&quot; и таким образом нам удасться &quot;отцепить&quot; модификатор. </p>
<p> Итак. Давайте возьмем реальный модификатор <strong>Mod5</strong>. Он используется только  для символа <strong>Scroll_Lock</strong>, а этот символ, в свою очередь, &quot;подвешен&quot; только  на клавишу <strong>ScrollLock </strong>(скан-код <strong>&lt;SCLK&gt;</strong>). Да и клавиша эта не самая  &quot;часто используемая&quot;. </p>
<p> Теперь нам надо добавить в описание клавиши <strong>&lt;MENU&gt;</strong> виртуальный модификатор <strong>LevelThree</strong>. Добавить инструкцию <strong>modifier_map</strong>, который свяжет <strong>Mod5</strong> с нашей  клавишей. И, наконец, переопределить клавишу <strong>&lt;SCLK&gt;</strong>, чтобы в ней не было  упоминания и символе <strong>Scroll_Lock</strong>. </p>
<p>key &lt;MENU&gt; 	{ virtualMods = LevelThree,  		[ NoSymbol],  		actions[Group1]=[ LockMods(modifiers=LevelThree) ]};    modifier_map Mod5 { &lt;MENU&gt; };    key SCLK { [NoSymbol] };  </p>
Вот теперь можно пробовать - что получилось.
<p> Конечно, это не самое лучшее решение. </p>
<ul>
  <li>Во-первых, из-за того, что мы заняли реальный модификатор <strong>Mod5</strong> (кстати,  и отмена <strong>ScrollLock</strong> не во всех случаях спасает). </li>
  <li>Во-вторых, наш дополнительный переключатель сам группы не меняет, а только  &quot;машет флагом&quot;. Поэтому, если переключение &quot;из лат. в рус&quot; работает  всегда, то для переключения &quot;из одного рус. в другой рус.&quot; надо не только  нажать дополнительный преключатель, но и &quot;щелкнуть&quot; основным. </li>
  <li>Ну и, наконец, если мы захотим задействовать все четыре группы, то  решение будет еще сложнее (понадобится как минимум два виртуальных  модификатора, с которыми и так &quot;напряженка&quot;). </li>
</ul>
Поэтому рассмотрим еще один способ -
<h3><a name="3" id="3">Третий способ (через дополнительную переменную номера группы).</a></h3>
<p> Вспомним еще раз - в чем проблема. В том, что основной переключатель  должен переходит из одного состояния (текущая группа - Group1), в два  разных, в зависимости от состояния какой-то другой клавиши. </p>
<p> Но ведь можно &quot;запомнить&quot; состояние дополнительного переключателя  нет только с помощью модификатора. </p>
<p> Напомню, что номер группы может храниться в трех внутренних переменных  XKB - <strong>locked, latched</strong> и <strong>base group</strong>, значение которых можно менять  независимо. Причем для выбора символа у клавиши используется суммарное  значение этих переменных - <strong>effective group</strong>. </p>
<p> Напомню также, что благодаря &quot;методу выравнивания номера группы&quot;  (см. <a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/internals.html#wrap">&quot;Внутренности&quot;:Метод выравнивания...&quot;</a>),  если суммарное значение  окажется больше, чем количество существующих групп на единицу, то опять  получится первая группа и т.д. </p>
<p> Таким образом, можно заставить дополнительный переключатель &quot;запоминать&quot;  номер &quot;альтернативной&quot; группы в дополнительной &quot;групповой&quot; переменной,  например - <strong>base group</strong>. А основной переключатель пусть манипулирует  значением в другой переменной, например - <strong>locked group</strong>. </p>
<p> Итак. Пусть дополнительный переключатель запоминает - какая из &quot;русских&quot;  групп нам требуется (2 или 3), например, в переменной <strong>base group</strong>. </p>
<p> Тогда основной переключатель, чтобы перейти из &quot;лат&quot; в из &quot;рус&quot;  раскладок должен просто обнулить <strong>locked group</strong>. А для того, чтобы вернуться  обратно в &quot;лат&quot;, надо в <strong>locked group</strong> записать &quot;добавку&quot;, достаточно большую,  чтобы &quot;метод выравнивания&quot; &quot;завернул&quot; значение обратно к &quot;лат&quot; раскладке. </p>
<p> Таким образом мы нашу проблему (переход из Group1 в два разных состояния)  решаем. Правда теперь у на появляется проблема - как вернуться обратно  из разных состояний в одно и ту же группу. Но она то, решается очень просто.  Поскольку клавиатура при этом находится в разных состояниях (Group2 и Group3),  то мы без проблем &quot;подвешиваем&quot; на клавишу два разных &quot;действия&quot;, каждое  со своим значением &quot;добавки&quot;. </p>
<p> Прежде чем переходить написанию конфигурации клавишь, давайте проясним  вопрос: что значит &quot;обнулить&quot; переменную с номером группы, и - какие  &quot;добавки&quot; нам понадобятся. </p>
<p> Надо сказать об одной тонкости - хотя в &quot;конфигах&quot; группы нумеруются -  1,2,3..., внутри XKB это означает - 0,1,2... <br/>
  То есть, group1 - на самом деле 0, group2 - 1 и т.д. </p>
<p> Итак. Давайте сначала рассмотрим задачу во внутренних значениях XKB (0,1,2). <br/>
  Тогда у нас </p>
<ul>
  <li> первая группа (&quot;лат&quot;) - 0 </li>
  <li> вторая группа (&quot;старый рус.&quot;) - 1 </li>
  <li> третья группа (&quot;новый рус.&quot;) - 2 </li>
  <li> максимальный номер группы - 2 </li>
</ul>
При этом
<ul>
  <li> если к 1 добавить 2 - получится снова 0 (3 на единицу больше, чем  &quot;максимальный номер группы&quot;) </li>
  <li> аналогично, если к 2 добавить 1 - снова вернемся к группе 0. </li>
</ul>
<p> Тогда алгоритм работы переключателей мог бы быть таким - </p>
<ul>
  <li> в дополнительной переменной (<strong>base group</strong>) запоминается номер одной из  русских раскладок - то есть, 1 или 2; </li>
  <li> для того, чтобы перейти из состояния, когда текущая группа &quot;лат&quot;,  в выбранную &quot;рус&quot;, надо просто в <strong>locked group</strong> записать 0; </li>
  <li> а для того, чтобы вернуться в &quot;лат&quot; из состояния &quot;рус.&quot; надо в переменную <strong>base group</strong> записать -
    <ul>
        <li> 2, если текущая группа 1; </li>
      <li> 1, если текущая группа 2. </li>
    </ul>
  </li>
</ul>
<p> Однако, не все так просто. Если мы попытаемся воплотить это в конфигурацию  клавиши, то нарвемся на очередную &quot;засаду&quot;. </p>
<p> Дело в том, что значения номера группы &quot;запоминаются&quot; только в <strong>locked group</strong>.  В других переменных (<strong>base</strong> и <strong>latched</strong>) они &quot;держаться&quot; только пока соответствующая  клавиша нажата и &quot;испаряются&quot; оттуда, если клавишу отпустить. </p>
<p> Правда, у нас есть одна &quot;лазейка&quot;. Мы можем изменить поведение клавиши  (той, что будет менять <strong>base group</strong>) и сделать ее &quot;залипающей&quot;. Тогда XKB при  первом нажатии/отжатии клавиши выполнит только ту задачу, которая выполняется  при нажатии клавиши, а при повторном нажатии/отжатии наоборот - только то,  что выполняется при отжатии клавиши. </p>
<p> Только обратите внимание, что когда мы ее все-таки &quot;отожмем&quot; там  получится 0. То есть, мы не сможем держать там &quot;2 или 3&quot;, а только &quot;2 или 0&quot;,  &quot;1 или 0&quot; и т.п. </p>
<p> Ну и ладно. Придется в ней держать не &quot;номер алтернативной раскладки&quot;,  а только &quot;добавку&quot; к номеру. То есть - не &quot;2 или 3&quot;, а &quot;0 или 1&quot;. </p>
<p> Тoгда нам придется слегка подправить наш алгоритм - </p>
<ul>
  <li> в дополнительной переменной (<strong>base group</strong>) запоминается &quot;смещение&quot; от  первой &quot;русской&quot; раскладки  - 0 или 1; </li>
  <li> для того, чтобы перейти из состояния &quot;лат&quot;, в нужную &quot;рус&quot;, надо в <strong>locked group</strong> записать 1; </li>
  <li> для того, чтобы вернуться в &quot;лат&quot; из состояния &quot;рус.&quot; надо в переменную <strong>base group</strong> записать -
    <ul>
        <li> если текущая группа 1 (в base 0) - 0; </li>
      <li> если текущая группа 2 (в base 1) - 2. </li>
    </ul>
  </li>
</ul>
<p> Теперь, переходя к обозначениям из &quot;конфигов&quot; (<strong>group1, group2</strong> и т.д.),  получим - </p>
<ul>
  <li> дополнительный переключатель:
    <ul>
        <li> ну, 0 или <strong>Group1</strong> там получится автоматически при &quot;отжатии&quot; клавиши </li>
      <li> &quot;запоминать&quot; в <strong>base group</strong> надо <strong>Group2</strong>, </li>
    </ul>
  </li>
  <li> основной переключатель:
    <ul>
        <li> &quot;действие&quot; для <strong>Group1</strong> - записать в <strong>locked group</strong> значение <strong>Group2</strong> </li>
      <li> для <strong>Group2</strong> - записать <strong>Group1</strong> </li>
      <li> для <strong>Group3</strong> - записать <strong>Group3</strong> </li>
    </ul>
  </li>
</ul>
<p> Сочиняем описание клавиш (пусть это будут те же <strong>&lt;CAPS&gt;</strong> и <strong>&lt;MENU&gt;</strong>) </p>
<p>key &lt;CAPS&gt; { [NoSymbol],[NoSymbol],[NoSymbol],  	    actions[Group1]= [ LockGroup(group=2) ],  	    actions[Group2]= [ LockGroup(group=1) ],  	    actions[Group3]= [ LockGroup(group=3) ] };    key &lt;MENU&gt; 	{ [ NoSymbol ], locks= yes  		actions[Group1]=[ SetGroup(group=2) ]};  </p>
(обратите внимание - мы для дополнительного переключателя опять описываем  только одну группу. Все равно он может &quot;перещелкивать&quot; только два состояния,  и делать его &quot;чувствительным&quot; к текущей группе нет смысла.)
<p> Можно пробовать. </p>
<p> Правда, надо признаться, что этот метод тоже не лишен недостатков.  Если вы начнете менять альтернативную раскладку, когда основной переключатель  стоит в положении <strong>&quot;какой-нибудь рус.&quot;</strong> - все будет нормально. </p>
<p> Но вот если &quot;пощелкать&quot; им, когда основной переключатель стоит в состоянии <strong>&quot;лат&quot;</strong>, то результаты будут несколько &quot;странные&quot; (вы можете сами их  &quot;просчитать&quot;), поскольку &quot;состояние лат.&quot; на самом деле - &quot;хитро&quot;  подобранная  сумма двух переменных (<strong>base</strong> и <strong>locked</strong>). </p>
<p> С другой стороны, с этим можно примириться. Скорее всего в реальной работе  вы будете &quot;подгонять&quot; русскую раскладку, когда основной переключатель стоит  в сотоянии <strong>&quot;рус&quot;</strong>, а не готовить ее заранее (когда основной переключатель в  состоянии <strong>&quot;лат&quot;</strong>). </p>
<p> Замечу также, что это не единственный вариант переключения &quot;с помощью  двух переменных group&quot;. Можно, например, сделать так, чтобы дополнительный  переключатель работал с <strong>locked group</strong>, а основной - с <strong>base group</strong> (если  посмотреть исходный алгоритм, то там у основного переключателя есть состояние  когда он &quot;держит&quot; в &quot;своей&quot; переменной 0). Но этот вариант не лучше в смысле  &quot;побочных эффектов&quot;, а в описании, пожалуй, сложнее. </p>
<p> Поэтому, пока не этом и остановимся. <br/>
  Тем более, что у нас остался еще - </p>
<h3><a name="final" id="final">&quot;Заключительный аккорд&quot; - &quot;отцепляемся&quot; от скан-кодов.</a></h3>
<p> Как я уже говорил - не очень хорошо, когда &quot;действия&quot; назначаются прямо   в описании клавиши (в файлах <strong>xkb_symbols</strong>). </p>
<p> Во всяком случае, при этом трудно распространить наше решение на случай,  когда роль основного или дополнительного переключателей (или обоих) выполняет  не одиночная клавиша, а комбинация клавиш. </p>
<p> Обычно &quot;хорошим тоном&quot; является - привязать &quot;действия&quot; к каким-нибудь  сиволам (через &quot;интерпретации&quot;), а в описании клавиш использовать только  символы. </p>
<p> Давайте проделаем это для любого из примеров, например, последнего. </p>
<p> Единственная проблема - надо подобрать подходящии символы. Дело в том, что  брать коды обычных символов (даже &quot;экзотических&quot; - типа &quot;умлаутов&quot;) не очень  хорошо. Потому, что при нажатии клавиши XKB будет не только выполнять  соответствующие &quot;действия&quot;, но и выдавать в прикладную программу эти  символы. А программа, соответственно, будет пытаться их напечатать. </p>
<p> К счастью, в наборе символов есть группа кодов, которые должны  использоваться только для внутренних нужд XKB и игнорироваться прикладными  программами. Вы можете найти их в файле <strong>{XROOT}/include/X11/keysymdef.h</strong> их названия начинаются на <strong>XK_ISO_</strong>.    Например, </p>
<p>XK_ISO_First_Group  XK_ISO_First_Group_Lock  XK_ISO_Last_Group  XK_ISO_pv_Group_Lock  </p>
и т.п.
<p> Конечно, там нет символов из названия которых следует, что по этому символу <strong>&quot;записать в locked group число 3&quot;</strong>. Но мы можем изменить семантику любого из  символов (тем более, что и не для каждого из этих символов задана семантика  в &quot;конфигах&quot; XKB). </p>
<p> Давайте сначала выясним - сколько нам надо символов. Для этого посчитаем -  сколько у нас различных действий в описании обоих переключателей. </p>
<p>LockGroup(group=1)  LockGroup(group=2)  LockGroup(group=3)  SetGroup(group=2)  </p>
Итого - 4 штуки.
<p> Давайте подберем им символы. Конечно, можно взять любые из тех о которых  говорилось выше. Но, чтобы лучше в них ориентироваться, подберем такие,  чтобы их название хоть немного походили на соответствующие действия. </p>
<p> Обратите внимание, чтов  названиях присутствуют - <strong>First_Group, Last_Group,  Next_Group</strong> и <strong>pv_Group</strong>. </p>
<p> Давайте считать, что для нашего случая </p>
<ul>
  <li><strong>First_Group</strong> - group=<strong>1</strong> </li>
  <li><strong>Next_Group</strong> - group=<strong>2</strong> </li>
  <li><strong>Last_Group</strong> - group=<strong>3</strong> </li>
</ul>
<p> Тогда логично выбрать </p>
<ul>
  <li>для <strong>LockGroup(group=1) - ISO_First_Group_Lock</strong> </li>
  <li>для <strong>LockGroup(group=2) - ISO_Next_Group_Lock</strong> </li>
  <li>для <strong>LockGroup(group=3) - ISO_Last_Group_Lock</strong> </li>
  <li>для <strong>SetGroup(group=2)  - ISO_Group_Lock</strong> </li>
</ul>
<p> Составим соответствующие &quot;интерпретации&quot;. Напомню, что это нужно делать  в файле типа <strong>xkb_compat</strong> и, соответственно, &quot;приплюсовать&quot; это файл к строчке  в &quot;полной&quot; конфигурации, которая описывает именно <strong>xkb_compat</strong> (а не <strong>xkb_symbols</strong>). </p>
<p> Итак, наша &quot;добавка&quot; к <strong>xkb_compat</strong> (не забудьте ее &quot;приплюсовать&quot; куда надо) - </p>
<p>xkb_compat {    interpt ISO_First_Group_Lock { action=LockGroup(group=1); };    interpt ISO_Next_Group_Lock  { action=LockGroup(group=2); };    interpt ISO_Last_Group_Lock  { action=LockGroup(group=3); };    interpt ISO_Group_Lock       { action=SetGroup(group=2); locking = True;};       group 2 = AltGr;    group 3 = AltGr;  };  </p>
(Последнии две инструкции, &quot;по идее&quot; не нужны, поскольку уже должны быть  в &quot;общей конфигурации&quot;. Но почему-то они иногда &quot;теряются&quot;.)
<p> А описание символов (в <strong>xkb_symbols</strong>) теперь будут выглядеть как </p>
<p>key &lt;CAPS&gt; {	[ ISO_Next_Group_Lock ],  		[ ISO_First_Group_Lock ],  		[ ISO_Last_Group_Lock ] };    key &lt;MENU&gt; 	{ [ ISO_Group_Lock ] };  </p>
<p> Можно пробовать. </p>
<p> На этом наши эксперименты на тему переключателей не заканчиваются. <br/>
  Дальше мы рассмотрим еще более сложный случай (и другие механизмы) - </p>
<h3><a href="https://web.archive.org/web/20190622030203/http://pascal.tsu.ru/other/xkb/example4.html">Еще несколько &quot;переключателей&quot;.</a></h3></td>
<td width="200" class="links" valign="top" align="left" style="padding-top:150px;">
</td>
</tr>
</table>
<div id="copyright">&copy; <a href="https://web.archive.org/web/20190622030203/mailto:pascal@tsu.ru">Иван Паскаль</a></div>
</body>
</html>
<!--
     FILE ARCHIVED ON 03:02:03 Jun 22, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 22:56:29 Aug 11, 2022.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 120.639
  exclusion.robots: 0.218
  exclusion.robots.policy: 0.21
  RedisCDXSource: 7.851
  esindex: 0.008
  LoadShardBlock: 95.897 (3)
  PetaboxLoader3.datanode: 133.109 (4)
  CDXLines.iter: 13.872 (3)
  load_resource: 222.135
  PetaboxLoader3.resolve: 171.442
-->
