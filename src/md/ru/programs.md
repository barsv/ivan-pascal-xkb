Программы, имеющие отношение к XKB.
-----------------------------------

*   [xkbcomp](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#xkbcomp)
*   [setxkbmap](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#setxkbmap)
*   [xmodmap](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#xmodmap)
*   [xkbwatch](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#xkbwatch)
*   [xkbvleds и mxkbledpanel](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#xkbvleds)
*   [xkbevd и xkbbell](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#xkbevd)
*   [xkbprint](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#xkbprint)
*   [Программа для редактирования раскладки - xkeycaps.](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#editor)
*   [Индикаторы-переключатели.](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/programs.html#indicators)

### xkbcomp

Это самая важная программа. Во всяком случае, она отрабатывет каждый раз при старте "иксов" для того, чтобы перевести файлы конфигурации XKB в бинарный формат, понятный самому X-серверу. (Как понятно из названия, это - "XKB compiler").

Но более полезно то, что ее можно вызвать и "вручную". При этом, она может выполнять и обратное преобразование - из бинарной формы в "человекочитаемый" конфигурационный файл. И что самое полезное - она может обмениваться данными (записывать и читать) непосредственно с работающим X-сервером.

То есть, ее можно использовать для того, чтобы в ходе работы загрузить новую конфигурацию XKB в X-сервер, или наоборот - прочитать текущую конфигурацию и перевести ее в "читабельный" формат.

Последнее тоже важно. Поскольку полная конфигурация складывается из содержимого многих файлов/блоков (не забудьте, что в любом файле может быть '**include**'), понять - что же должно получится в результате такого "сложения" - не так-то просто. С помощью **xkbcomp** можно "вытащить" из X-сервера "суммарную" конфигурацию (в виде полной **xkb\_keymap**).

Полную информацию о **xkbcomp** можно прочитать в соответствующем **man**'е.  
Поэтому, приведу лишь примеры - как можно "обменяться информацией" с X-сервером. Вообще-то, если в качестве источника или приемника данных надо указать X-сервер, это можно сделать (как сказано в **man X**) в форме

hostname:dispalay\_number.screen\_number  

В простейшем случае, когда X-сервер запущен на вашей же машине, причем - только один и с одним "скрином", эта последовательность выглядит как "**:0**".

Таким образом, для чтения текущей конфигурации XKB можно использовать команду

xkbcomp :0 outfile  

(можно даже не указывать **outfile**, в этом случае программа сама сочинит имя для выходного файла, типа - **server-0.xkb**).

Обратите также внимание на ключи **\-a** (all) и **\-dflts** (defaults). С ними выходная информация будет более полной.

Соответствено, для загрузки новой конфигурации можно использовать команду

xkbcomp xkbfile :0  

Подразумевается, что **xkbfile** в этом случае - файл типа **xkb\_keymap**. Хотя он может и не содержать непосредственно в себе все необходимые описания (как это получается в выходном файле при чтении из X-сервера), а только указывать с помощью **include** файлы-компоненты полной конфигурации.

Кстати, эти файлы **xkbcomp** ищет сначала в текущей директории и, если не находит, то в "базе данных" конфигураций (**X11R6/lib/X11/xkb/**).

Примеры составления своих файлов конфигурации для "подсовывания" их **xkbcomp** можно посмотреть в ["Примеры изменения конфигурации XKB: Где будем экспериментировать."](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/examples.html)

### setxkbmap

Еще одна утилита, которая позволяет "на ходу" поменять конфигурацию XKB.  
Пожалуй, главное ее преемущество перед **xkbcomp** в том, что она понимает задание конфигурации в виде **rules-model-layout...** (**xkbcomp** этих слов не понимает).

С другой строны, **setxkbmap** может брать данные только из файлов "базы данных" настроек (причем, только на той же машине, где запущен X-сервер). То есть, если вы составите свой файл конфигурации, то прежде чем воспользоваться **setxkbmap**, необходимо поместить этот файл в нужное место (в соответствующую поддиректорию) "базы данных". (Кстати, **setxkbmap** еще и не понимает входные данные в виде **xkb\_keymap**, хотя это просто "глюк" программы.)

Кстати, если будете с ее помощью менять русскую раскладку, не забудьте, что файл **ru** и все его "вариации" обычно содержать только "частичное" описание клавиатуры.

Если вы выполните команду типа

setxkbmap -symbols ru  

то результат будет очень неприятным. У вас "отсохнут" все "небуквенные" клавиши, включая Esc, BackSpace, Enter (!) и т.д.

Поэтому, правильная команда должна выглядеть как

setxkbmap -symbols "en\_US+ru"  

Самое полезное применение этой программы - "сброс" XKB в исходное состояние после неудачных экспериментов со своими файлами конфигурации. :-)  
Если запустить ее без параметров, то она прочитает ту конфигурацию, которая описана в **XF86Config** и загрузит ее.

Более подробно об этой утилите можно прочитать в соответствующем man'е, а краткую сводку ключей можно получить по команде

setxkbmap -?  

### xmodmap

Как ни странно, но эта программа тоже может использоваться для работы с XKB. Просто, она работает с клавиатурным модулем с помощью "старого" протокола (core protocol). Но поскольку XKB "из соображений совместимости" этот протокол понимает, то вполне может воспринять таблицы, загружаемые с помощью **xmodmap**.

Естественно, используя **xmodmap**, вы лишаетесь всех дополнительных возможностей XKB. Но для простейших исправлений раскладки клавиатуры ее вполне можно использовать.

Единственное, что я бы не советовал - использовать широкораспростаненные файлы для руссификации клавиатуры в формате **xmodmap** (.Xmodmap). Почему этого делать не стоит, написано в ["Почему руссификация через XKB не работает"](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/problems.html).

Подробности об этой программа читайте в соответствующем **man**'е. (Но если вы не знаете - что такое **xmodmap**, то ... лучше и не знать :-).

### xkbwatch

Эта утилитка показывает текущее состояние "виртуальных" и "реальных" модификаторов. К сожалению, она имеет очень "скромную внешность" (никаких подписей - только какие-то безымянные "лампочки") и, к тому же, остутствует какое-либо описание к ней. (Похоже, авторы писали ее "только для себя", но зачем-то засунули в дистрибутив. :-)

На самом деле, если знать - что именно она показывает, **xkbwatch** может оказаться весьма полезной при отладке своих файлов конфигурации.

Итак, восполняя пробелы в описании, привожу табличку, поясняющую значение индикаторов **xkbwatch**

base

O

O

O

O

O

O

O

O

latched

O

O

O

O

O

O

O

O

locked

O

O

O

O

O

O

O

O

effective

O

O

O

O

O

O

O

O

реальные

O

O

O

O

O

O

O

O

Mod5

Mod4

Mod3

Mod2

Mod1

Control

Lock

Shift

### xkbvleds и mxkbledpanel

Утилита **xkbvleds** предназначаена для отображения состояния виртуальных индикаторов XKB (в том числе и тех, которые имеют "реальные" аналоги в виде светодиодов на клавитатуре).

К сожалению, она выполнена в том же аскетичном стиле (никаких подписей), что и **xkbwatch**. И точно так же не имеет никакого описания.

Поэтому я не буду ничего о ней рассказывать (хотя она даже имеет какие-то ключи), а посоветую забыть о ней и, если хочется чего-то подобного, воспользоваться другой аналогичной утилиткой - **mxkbledpanel**.

Эта утилита имеет более "человеческое лицо". Все индикаторы на ней подписаны (естественно - те, которые реально используются; напомню, что в XKB может быть до 32 виртуальных индикаторов, но это не значит, что все они задействованы в конкретной конфигурации).

Кроме того, эта программа позволяет осуществлять и "обратную связь", если это предусмотренно в конфигурации (подробнее - смотрите в ["Немного о внутренностях XKB":"Индикаторы"](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/internals.html#indicators) и ["Описание поведения индикатора"](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/gram-compat.html#indicator):drivesKeyboard). То есть, "щелкая мышью" по индикатору можно включать/выключать его и таким образом менять соответствующее состояние XKB. (Кстати, благодаря этому, **mxkbledpanel** может служит простейшим индикатором-переключателем "РУС/ЛАТ").

Недостатки этой программы в том, что она во-первых требует для сборки Motif (хотя должно хватить и lesstif'а), а во-вторых - не входит в дистрибутивы XFree. Найти ее можно, например, на - [ftp://ftp.x.org/pub/unsupported/Motif/mxkbledpanel/](https://web.archive.org/web/20190720052135/ftp://ftp.x.org/pub/unsupported/Motif/mxkbledpanel/)

### xkbevd и xkbbell

Судя по названию, **xkbevd** - "XKB event daemon". Как сказано в **man xkbevd**, "эта команда очень 'сырая'... мы предлагаем ее скорее как 'черновой прототип' для разработчиков, а не как инструмент для 'конечных юзеров'".

В основном она принимает **bell event**'ы и может служить "музыкальной приставкой" (подробнее смотрите в ["Внутренности XKB: Расширенные возможности 'пищалки'"](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/internals.html#bell)).

Правда сам **xkbevd** звуки не воспроизводит. В его конфигурационном файле можно указать имя программы для воспроизведения звуков и соответствия между "именем звука" и аудио-файлом, который надо передать в качестве аргумента этой программе.

А вот программа **xkbbell** служит "тестером" для "расширенных возможностей 'пищалки'". Она просто посылает запрос модулю **XKB** для воспроизведения звука. Причем, с ее помощью можно заказать как обычный "писк" (с помощью ключа **\-force**), так и "музыкальный фрагмент", указав в качестве аргумента "имя звука".  
С помощью дополнительных ключей можно симитировать запрос от конкретного приложения (окна).

Как я уже сказал, **xkbbell** служит скорее "тестером", чем полезной утилитой. Хотя ее можно использовать и в своих "скриптах", как команду для проигрывания звуков (естественно, должна быть запущена хоть какая-нибудь XKB-совместимая "музыкальная приставка").

Подробности о **xkbevd** можно почитать в соответствующем **man**'е. А для **xkbbell** никакого описания нет. Правда, можно посмотреть хотя бы список ключей, запустив ее с ключем **\-help**.

### xkbprint

Эта утилита генерирует картинку (в формате postscript'а) изображающую клавиатуру. При этом она использует как описание геометрии (**xkb\_geometry**), так и "назначение" клавиш. То есть, кроме отрисовывания самой геометрии клавиатуры, она еще и подписывает - какой символ генерируется каждой клавишей.

Особой пользы от нее я не вижу. Разве что - проверить правильность описания геометрии (собственно, кроме этой утилитки ее никто и не использует), да еще увидеть на картинке расположение сразу всех символов.

Подробности - в **man xkbprint**.

### Программа для редактирования раскладки - xkeycaps.

Вообще-то, нормальной программы для создания/редактирования раскладок клавиатур в формате XKB - не существует.

Но при желании, для этой цели можно использовать "редактор xmodmap'ов" - [xkeycaps](https://web.archive.org/web/20190720052135/http://www.jwz.org/xkeycaps/). Обратите внимание, что она позволяет на каждую клавишу "подвешивать" до 8-и символов. Что вполне соответствует "четырем группам по два уровня" в терминах XKB.

И хотя она и сохраняет результат вашей работы в формате **xmodmap**, преобразовать его в формат файла типа **xkb\_symbols** достаточно просто. Можете воспользоваться моим "скриптом" [modmap2xkb](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/modmap2xkb), который делает это автоматически (конечно, программка очень "сырая". Если у кого-то есть желание ее улучшить - welcome).

Не могу не заметить, что **xkeycaps** в нынешнем виде - довольно плохой редактор. И дело даже не в том, что она не работает с файлами XKB и, соответственно, не может использоваться для редактирования **xkb\_types, xkb\_compat** и т.п. и, кроме того, не использует "геометрию" из **xkb\_geometry** (все "геометрии" "зашиты" в самой программе).

Основные ее недостатки в том, что

*   нет групповых операций - перемещения символов сразу всех (или выбраных) клавиш в другую группу
*   вообще нет "вырезания-вставки" даже для одной клавиши
*   нет возможности "подгружать" раскладки из файлов (даже в формате xmodmap). Выбирать можно только из тех раскладок, которые "вшиты" в саму программу.
*   и наконец - при сохранении результата она сама сочиняет имя файла (если вы хотите наделать несколько раскладок, вам после каждого сохранения придется вручную переименовывать файл)

Короче, **xkeycaps** представляет собой скорее забавный "эмулятор клавиатуры", чем полноценный "редактор раскладок".

### Индикаторы-переключатели.

Несмотря на то, что XKB сам может поддерживать несколько (до четырех) различных раскладок и легко переключать их "на ходу", ему очень не хватает подходящей программы для удобной манипуляции раскладками и отображения текущего состояния ("лампочек" на клавиатуре явно недостаточно для индикации состояния, если раскладок больше двух).

Кроме того, большинство пользователей уже привыкло к "индикаторам-переключателям" (типа **xrus**), которые позволяют переключать раскладки не только с клавиатуры, но и "щелчком мыши" и, к тому же, отображать "текущий язык" иконкой на дисплее.

Что же из таких программ можно посоветовать для работы "в паре с XKB"?

Надо заметить, что популярные "переключалки" типа **xruskb, xes, cyrx, kikbd** (кого я еще забыл упомянуть?) для этого плохо подходят.  
Во-первых, они используют раскладки "в старом стиле", то есть не с кодами Cyrillic, а "западноевропейскими" буквами. А это вызывает проблемы у "правильных" программ при корректно установленной locale (подробнее об этом в ["Почему руссификация через XKB не работает?"](https://web.archive.org/web/20190720052135/http://pascal.tsu.ru/other/xkb/problems.html)).  
А во-вторых, все они не используют возможности XKB для переключения раскладок, и "на каждое телодвижение" сами перезагружают раскладки в X-сервер.

"Настоящими" XKB-переключателями являются -

*   **kkb** - [http://www.logic.ru/peter](https://web.archive.org/web/20190720052135/http://www.logic.ru/peter)
*   **FvwmKb** - [http://linuxfan.com/~sparrow/software/](https://web.archive.org/web/20190720052135/http://linuxfan.com/%7Esparrow/software/)
*   **fookb** - [http://linux.piter-press.ru/fookb/](https://web.archive.org/web/20190720052135/http://linux.piter-press.ru/fookb/)
*   **xxkb** - [http://www.tsu.ru/~pascal/other/xxkb/](https://web.archive.org/web/20190720052135/http://www.tsu.ru/%7Epascal/other/xxkb/)

Не желая никого обидеть :-), все-таки выскажу некоторые замечания относительно этих программ (возможно - несколько запоздалые).

#### kkb

"Честная" Xkb-переключалка. Хотя в последних версях автор несколько отошел от "идеи XKB" и добавил "подгрузку" раскладок в процессе работы. Но надо заметить, что сделано это средствами XKB, то есть наиболее оптимальным способом.

Главный недостаток - для сборки требуется "тулкит" **Qt**.

#### FvwmKb

Главное достоинство этой программы - она запоминает состояние клавиатуры ("язык") для каждого открытого приложения и автоматически переключает его при изменении фокуса окна. Кроме этого, состояние клавиатуры отображается на "обрамлении" окон - иконкой, цветом рамки и т.п.

Главный недостаток - она "заточена" для работы с конкретным window manager'ом - Fvwm-2 (хотя со временем, возможно, будут версии и для других wm).

#### fookb

Очень простая и "легкая" переключалка. Основное достоинство - "легкость". Для сборки достаточно стандартных библиотек и, кроме того, из всех собратьев она - самая компактная.

Недостаток - опять же - простота. :-) Все остальные программы имеют какие-либо "фичи", недоступные **fookb**.

#### xxkb

Себя сильно хвалить не буду :-).  
Замечу только, что основное достоинство как и у FvwmKb - индивидуальное состояние для каждого окна. Но в отличии от FvwmKb - работает с любым wm.

Недостаток - довольно "аскетичный" вид. Выбор раскладки осуществляется просто перебором "иконок", а не с помощью "меню".